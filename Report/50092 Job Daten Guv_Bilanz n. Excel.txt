OBJECT Report 50092 Job Daten Guv_Bilanz n. Excel
{
  OBJECT-PROPERTIES
  {
    Date=09.02.26;
    Time=17:23:38;
    Modified=Yes;
    Version List=wird von Ulf benutzt;
  }
  PROPERTIES
  {
    ProcessingOnly=Yes;
    OnInitReport=BEGIN
                   //   Hier sind die Datumsangaben fr die Berichtsauswertung jedes Jahr anzupassen
                   //   auch in Funktion 'Systeme()' und 'Daten_Nav_Systeme' das Datum ( erste Zeile ) „ndern.
                   //PeriodStartDate[1] := 010720D;
                   //var_jahr[1] := 010719D;
                   //Abgrenz_Datum := 300621D;

                   PeriodStartDate[1] := 010725D;
                   var_jahr[1] := 010724D;
                   Abgrenz_Datum := 300626D;
                 END;

    OnPreReport=BEGIN
                  Daten_Nav_GuV;
                  Daten_Nav_Bil;
                  Daten_Nav_Systeme;
                  Daten_Nav_Dienstleistung;
                  Daten_Nav_UM;
                  Daten_Nav_AE;
                  Daten_Nav_Champs_gesamt;
                  Daten_NAV_Bestellbestand;
                END;

    OnPostReport=BEGIN
                   MESSAGE('Report 50092 Job Daten GuV_Bilanz ist beendet. Status = OK');
                 END;

    UseRequestPage=No;
  }
  DATASET
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
      { 1900000001;0;Container;
                  ContainerType=ContentArea }

      { 1900000002;1;Group  ;
                  CaptionML=[CSY=Moznosti;
                             DAN=Indstillinger;
                             DEU=Optionen;
                             ENU=Options;
                             FIN=Vaihtoehdot;
                             ISL=Valkostir;
                             NLD=Opties;
                             NOR=Alternativer;
                             SVE=Alternativ;
                             ITS=Opzioni;
                             NLB=Opties] }

    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      AU_PER@1000000042 : Record 50019;
      vkcode@1000000040 : Record 13;
      vkcode1@1000000039 : Record 13;
      Herstell@1000000038 : Record 5720;
      vkz@1000000037 : Record 37;
      VKRK@1000000036 : Record 112;
      VKRZ@1000000035 : Record 113;
      VKGK@1000000034 : Record 114;
      VKGZ@1000000033 : Record 115;
      Artikel@1000000032 : Record 27;
      Belege@1000000030 : Record 50010;
      AEMTL@1000000026 : Record 50017;
      vkk@1000000024 : Record 36;
      vkk_arch@1000000023 : Record 5107;
      vkz_arch@1000000022 : Record 5108;
      beleghis@1000000021 : Record 50008;
      sachkonten@1000000046 : Record 15;
      sachposten@1000000045 : Record 17;
      service@1000000044 : Record 50024;
      lief@1000000043 : Record 111;
      TempExcelBuffer@1000000014 : TEMPORARY Record 370;
      rech@1000000047 : Record 50010;
      alte_lief@1000000041 : Record 50008;
      deb@1000000003 : Record 18;
      wartkopf@1000000048 : Record 50011;
      PurchaseHeader@1000000050 : Record 38;
      PurchaseLine@1000000049 : Record 39;
      wshFile@1000000000 : Automation "{F935DC20-1CF0-11D0-ADB9-00C04FD58A0B} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Windows Script Host Object Model'.FileSystemObject";
      i@1000000028 : Integer;
      u@1000000029 : Integer;
      w@1000000001 : Integer;
      e@1000000002 : Integer;
      PeriodStartDate@1140010 : ARRAY [14] OF Date;
      PeriodLength@1140026 : DateFormula;
      var_bal@1140011 : ARRAY [13] OF Decimal;
      var_bal_total@1140027 : ARRAY [13] OF Decimal;
      var_balance@1140012 : ARRAY [13] OF Decimal;
      var_balance_monat@1000000025 : ARRAY [13] OF Decimal;
      var_balance_total@1140013 : ARRAY [13] OF Decimal;
      v_aubest@1140014 : ARRAY [13] OF Decimal;
      v_aubest_total@1140015 : ARRAY [13] OF Decimal;
      v_aubest1@1140016 : ARRAY [13] OF Decimal;
      v_aubest1_total@1140017 : ARRAY [13] OF Decimal;
      v_summe@1140018 : Decimal;
      v_summe_total@1140019 : Decimal;
      v_summe_aur@1140020 : Decimal;
      v_summe_aur1@1140022 : Decimal;
      v_sum_aubest@1140021 : Decimal;
      v_au_wert@1140023 : Decimal;
      v_aur_wert@1140024 : Decimal;
      v_sum_au@1140028 : Decimal;
      v_sum_au_rahmen@1140025 : Decimal;
      var_balance_gesamt_konto@1140031 : Decimal;
      var_balance_total_summe@1140033 : Decimal;
      liefnr@1140092 : Code[10];
      liefzeilennr@1140091 : Integer;
      start_jahr@1140084 : Integer;
      LZ_rest@1000000031 : Integer;
      LZ@1140077 : Integer;
      Rech_tagessatz@1140076 : Boolean;
      Sum_ek@1140073 : Decimal;
      Sum_vk@1140072 : Decimal;
      LZ_tage@1140071 : Integer;
      LZ_tage_stich@1140070 : Integer;
      LZ_tage_abgrenz@1140069 : Decimal;
      LZ_tage_bewert@1140068 : Integer;
      frei_lager@1140067 : Boolean;
      champsauswert@1140066 : Boolean;
      var_jahr@1140034 : ARRAY [30] OF Date;
      var_startjahr@1140106 : Date;
      champsstat@1140105 : Boolean;
      var_sj_eingabe@1140104 : Date;
      var_jahr_wert@1140103 : ARRAY [30] OF Decimal;
      LZ_tage_jahr@1140102 : ARRAY [30] OF Integer;
      var_jahr_gesamt@1140101 : ARRAY [30] OF Decimal;
      var_jahr_neu@1140100 : ARRAY [30] OF Decimal;
      var_jahr_verl„ng@1140099 : ARRAY [30] OF Decimal;
      var_jahr_abgelauf@1140098 : ARRAY [30] OF Decimal;
      v_rohbilanz@1140097 : Boolean;
      v_vorl_GuV@1140096 : Boolean;
      v_AE_per_Periode@1140095 : Boolean;
      Abgrenzung@1140108 : Boolean;
      Abgrenz_Datum@1140107 : Date;
      datum_zeit@1140109 : DateTime;
      sum_gj_12@1140110 : Decimal;
      sum_gj_36@1140111 : Decimal;
      sum_gj_sonst@1140112 : Decimal;
      sum_gj_gesamt@1140113 : Decimal;
      v_Daten_Nav_GuV@1140121 : Text[30];
      v_sachpostsum@1140122 : Decimal;
      v_kein_VCode@1140125 : Text[10];
      FileMgt@1000000013 : Codeunit 419;
      ServerFileName@1000000012 : Text;
      SheetName@1000000011 : Text[250];
      DoUpdateExistingWorksheet@1000000010 : Boolean;
      Testmode@1000000009 : Boolean;
      Window@1000000008 : Dialog;
      RecNo@1000000007 : Integer;
      TotalRecNo@1000000006 : Integer;
      RowNo@1000000005 : Integer;
      ColumnNo@1000000004 : Integer;
      Text000@1000000020 : TextConst 'DEU=Daten werden analysiert ...\\;ENU=Analyzing Data...\\';
      Text001@1000000019 : TextConst 'DEU=Hersteller;ENU=Manufacturer';
      Text002@1000000018 : TextConst 'DEU=Arbeitsmappe aktualisieren;ENU=Update Workbook';
      ExcelFileExtensionTok@1000000017 : TextConst '@@@={Locked};DEU=.xlsx;ENU=.xlsx';
      NewFileDirectory@1000000016 : TextConst 'DEU=F:\Daten Neu\User\Joachim\email_versand\POS Linien lfd\NAV2016\';
      Text003@1000000015 : TextConst 'DEU=Excel Export erfolgreich abgeschlossen.';
      beleghis_ek@1000000027 : Decimal;

    LOCAL PROCEDURE CreateExcel@1000000000();
    BEGIN
      IF DoUpdateExistingWorksheet THEN BEGIN
        IF ServerFileName = '' THEN
          ServerFileName := FileMgt.UploadFile(Text002,ExcelFileExtensionTok);
        IF ServerFileName = '' THEN
          EXIT;
        SheetName := TempExcelBuffer.SelectSheetsName(ServerFileName);
        IF SheetName = '' THEN
          EXIT;
      END;

      Window.OPEN(
        Text000 +
        '@1@@@@@@@@@@@@@@@@@@@@@\');

      TempExcelBuffer.DELETEALL;
      CLEAR(TempExcelBuffer);
    END;

    LOCAL PROCEDURE CloseExcel@1000000001(Sheetname@1000000000 : Text;Filename@1000000001 : Text;FilePath@1000000002 : Text);
    BEGIN
      Window.CLOSE;

      IF DoUpdateExistingWorksheet THEN BEGIN
        TempExcelBuffer.UpdateBook(ServerFileName,Sheetname);
        TempExcelBuffer.WriteSheet('',COMPANYNAME,USERID);
        TempExcelBuffer.CloseBook;
        IF NOT Testmode THEN
          TempExcelBuffer.DownloadAndOpenExcel;
      END ELSE BEGIN
        TempExcelBuffer.CreateBook(ServerFileName,Sheetname);
        TempExcelBuffer.WriteSheet(Sheetname,COMPANYNAME,USERID);
        IF STRPOS(Sheetname,'Bestellbestand') <> 0 THEN BEGIN
          TempExcelBuffer.SetWidth(1,'O',20);
          TempExcelBuffer.SetWidth(1,'P',25);
          TempExcelBuffer.SetWidth(1,'Q',25);
          TempExcelBuffer.SetWidth(1,'R',25);
        END;
        //TempExcelBuffer.SetWidth(1,'A',20);
        TempExcelBuffer.CloseBook;
        IF NOT Testmode THEN BEGIN
          IF (Filename = '') OR (FilePath = '') THEN
            TempExcelBuffer.OpenExcel //hat Autofit drin der die Spaltenbreite wieder berschreibt, deshalb neue Fkt. nachfolgend
          ELSE
            TempExcelBuffer.OpenExcelWithoutAutoFit(Sheetname,Filename + ExcelFileExtensionTok,FilePath,FALSE);
        END;
      END;
      IF NOT Testmode THEN
        TempExcelBuffer.GiveUserControl;
    END;

    LOCAL PROCEDURE EnterCell@1000000002(RowNo@1000000000 : Integer;ColumnNo@1000000001 : Integer;CellValue@1000000002 : Text[250];Formular@1000000008 : Text[250];Bold@1000000003 : Boolean;Italic@1000000004 : Boolean;UnderLine@1000000005 : Boolean;NumberFormat@1000000006 : Text[30];CellType@1000000007 : Option);
    BEGIN
      TempExcelBuffer.INIT;
      TempExcelBuffer.VALIDATE("Row No.",RowNo);
      TempExcelBuffer.VALIDATE("Column No.",ColumnNo);
      TempExcelBuffer."Cell Value as Text" := CellValue;
      TempExcelBuffer.Formula := Formular;
      TempExcelBuffer.Bold := Bold;
      TempExcelBuffer.Italic := Italic;
      TempExcelBuffer.Underline := UnderLine;
      TempExcelBuffer.NumberFormat := NumberFormat;
      TempExcelBuffer."Cell Type" := CellType;
      TempExcelBuffer.INSERT;
    END;

    LOCAL PROCEDURE UpdateCell@1000000003(RowNo@1000000000 : Integer;ColumnNo@1000000001 : Integer;CellValue@1000000002 : Text);
    BEGIN
      IF TempExcelBuffer.GET(RowNo,ColumnNo)  THEN BEGIN
        TempExcelBuffer."Cell Value as Text" := CellValue;
        TempExcelBuffer.MODIFY;
      END;
    END;

    LOCAL PROCEDURE Daten_Nav_Champs@1000000004();
    BEGIN
      CreateExcel;
      RowNo := 1;
      EnterCell(RowNo,1,'šbersicht der Champsvertr„ge per ','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := 2;
      EnterCell(RowNo,1,FORMAT(WORKDATE),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      ColumnNo:=2;
      FOR i:=1 TO 12 DO BEGIN
        var_jahr[i+1] := CALCDATE('1J',var_jahr[i]);
        ColumnNo:=ColumnNo+1;
        EnterCell(4,ColumnNo,'GJ '+FORMAT(var_jahr[i]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,4,'GJ '+FORMAT(var_jahr[2]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,5,'GJ '+FORMAT(var_jahr[3]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,6,'GJ '+FORMAT(var_jahr[4]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,7,'GJ '+FORMAT(var_jahr[5]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,8,'GJ '+FORMAT(var_jahr[6]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,9,'GJ '+FORMAT(var_jahr[7]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,10,'GJ '+FORMAT(var_jahr[8]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,11,'GJ '+FORMAT(var_jahr[9]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,12,'GJ '+FORMAT(var_jahr[10]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,13,'GJ '+FORMAT(var_jahr[11]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  EnterCell(4,14,'GJ '+FORMAT(var_jahr[12]),'',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      END;
      //  Ende šberschriftenanlage
      RowNo := 5;
      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      //Service.SETFILTER(Service."Hauptwartungsvertragsnr.",'%1|%2','SV101035','SV101119');
      IF service.FIND('-') THEN BEGIN  //xx1
        REPEAT
          LZ_rest:=0;
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          IF Artikel.FINDFIRST THEN BEGIN   //xx2
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief.Quantity,'<>%1',0);
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            lief.SETFILTER(lief."No.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
            IF lief.FINDFIRST THEN BEGIN  //xx3
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN   //xx4
              END ELSE BEGIN  //xx4_1
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
                FOR i:=1 TO 12 DO BEGIN   //xx5
                  LZ_tage:= (service."Ablaufdatum Serviceleistung"- service.Lizenzdatum);
                  var_jahr[i+1] := CALCDATE('1J',var_jahr[i]);
      //          Gesamt im Jahr abgeschlossen
      //          Hier wird das Buchungsdatum benutzt
                  IF (service.Belegdatum>(var_jahr[i])) AND (service.Belegdatum<(var_jahr[i]+365)) THEN
                  var_jahr_gesamt[i]:=var_jahr_gesamt[i]+(lief.Quantity*lief."VK-Preis (MW)");
      //          Ende Gesamt im Jahr abgeschlossen
      //          Gesamt im Jahr neu abgeschlossen
                  IF service.Verl„ngerung=FALSE THEN BEGIN   //xx6
                    IF (service.Belegdatum>(var_jahr[i])) AND (service.Belegdatum<(var_jahr[i]+365)) THEN
                    var_jahr_neu[i]:=var_jahr_neu[i]+(lief.Quantity*lief."VK-Preis (MW)");
                  END;   //xx6
      //          Ende Gesamt im Jahr neu abgeschlossen
      //          Gesamt im Jahr verl„ngert
                  IF service.Verl„ngerung=TRUE THEN BEGIN   //xx7
                    IF (service.Belegdatum>(var_jahr[i])) AND (service.Belegdatum<(var_jahr[i]+365)) THEN
                    var_jahr_verl„ng[i]:=var_jahr_verl„ng[i]+(lief.Quantity*lief."VK-Preis (MW)");
                  END;   //xx7
      //          Ende Gesamt im Jahr verl„ngert
      //          Gesamt im Jahr abgelaufen
                  IF (service."Ablaufdatum Serviceleistung">(var_jahr[i])) AND (service."Ablaufdatum Serviceleistung"<(var_jahr[i]+365)) THEN
                  var_jahr_abgelauf[i]:=var_jahr_abgelauf[i]+(lief.Quantity*lief."VK-Preis (MW)");
      //          Ende Gesamt im Jahr abgelaufen
      //          Laufzeitenberechnung  ******************************************************************
                  IF ((service.Lizenzdatum>=(var_jahr[i])) AND (service.Lizenzdatum<=(var_jahr[i]+365))) THEN BEGIN   //xx8
                    LZ_tage_jahr[i]:=var_jahr[i]+365-service.Lizenzdatum;
                    var_jahr_wert[i]:=var_jahr_wert[i]+((lief.Quantity*lief."VK-Preis (MW)")/LZ_tage*LZ_tage_jahr[i]);
                  END;   //xx8
                  IF (service."Ablaufdatum Serviceleistung">(var_jahr[i]+365)) AND ((var_jahr[i])>service.Lizenzdatum) THEN BEGIN   //xx9
                    LZ_tage_jahr[i]:=var_jahr[i]+365-var_jahr[i];
                    var_jahr_wert[i]:=var_jahr_wert[i]+((lief.Quantity*lief."VK-Preis (MW)")/LZ_tage*LZ_tage_jahr[i]);
                  END;   //xx9
                  IF ((service."Ablaufdatum Serviceleistung"-1>(var_jahr[i])) AND (service."Ablaufdatum Serviceleistung"-1<(var_jahr[i]+365))) THEN BEGIN   //xx10
                    LZ_tage_jahr[i]:=service."Ablaufdatum Serviceleistung"-1-var_jahr[i];
                    var_jahr_wert[i]:=var_jahr_wert[i]+((lief.Quantity*lief."VK-Preis (MW)")/LZ_tage*LZ_tage_jahr[i]);
                  END;   //xx10
      //          ENDE Laufzeitenberechnung ******************************************************************
                END;  //xx5
              END; //xx4_1
            END;   //xx11


            beleghis.RESET;
            beleghis.SETFILTER("Belegnr.",'%1',service."Nr.");
            beleghis.SETFILTER("Zeilennr.",'%1',service."Belegzeilennr.");
            beleghis.SETFILTER(Herstellercode,'<>%1&<>%2&<>%3','5710','5720','5730');
            IF beleghis.FINDFIRST THEN BEGIN
              IF (liefnr = beleghis."Belegnr.") AND (liefzeilennr = beleghis."Zeilennr.") THEN BEGIN
              END ELSE BEGIN
                liefnr:=beleghis."Belegnr.";
                liefzeilennr:=beleghis."Zeilennr.";
                FOR i := 1 TO 12 DO BEGIN   //xx5
                  LZ_tage:= (service."Ablaufdatum Serviceleistung"- service.Lizenzdatum);
                  var_jahr[i+1] := CALCDATE('1J',var_jahr[i]);

                  IF (service.Belegdatum>(var_jahr[i])) AND (service.Belegdatum<(var_jahr[i]+365)) THEN
                  var_jahr_gesamt[i]:=var_jahr_gesamt[i]+(beleghis.Menge*beleghis."VK-Preis");

                  IF service.Verl„ngerung=FALSE THEN BEGIN   //xx6
                    IF (service.Belegdatum>(var_jahr[i])) AND (service.Belegdatum<(var_jahr[i]+365)) THEN
                    var_jahr_neu[i]:=var_jahr_neu[i]+(beleghis.Menge*beleghis."VK-Preis");
                  END;   //xx6

                  IF service.Verl„ngerung=TRUE THEN BEGIN   //xx7
                    IF (service.Belegdatum>(var_jahr[i])) AND (service.Belegdatum<(var_jahr[i]+365)) THEN
                    var_jahr_verl„ng[i]:=var_jahr_verl„ng[i]+(beleghis.Menge*beleghis."VK-Preis");
                  END;   //xx7

                  IF (service."Ablaufdatum Serviceleistung">(var_jahr[i])) AND (service."Ablaufdatum Serviceleistung"<(var_jahr[i]+365)) THEN
                  var_jahr_abgelauf[i]:=var_jahr_abgelauf[i]+(beleghis.Menge*beleghis."VK-Preis");

                  IF ((service.Lizenzdatum>=(var_jahr[i])) AND (service.Lizenzdatum<=(var_jahr[i]+365))) THEN BEGIN   //xx8
                    LZ_tage_jahr[i]:=var_jahr[i]+365-service.Lizenzdatum;
                    var_jahr_wert[i]:=var_jahr_wert[i]+((beleghis.Menge*beleghis."VK-Preis")/LZ_tage*LZ_tage_jahr[i]);
                  END;   //xx8
                  IF (service."Ablaufdatum Serviceleistung">(var_jahr[i]+365)) AND ((var_jahr[i])>service.Lizenzdatum) THEN BEGIN   //xx9
                    LZ_tage_jahr[i]:=var_jahr[i]+365-var_jahr[i];
                    var_jahr_wert[i]:=var_jahr_wert[i]+((beleghis.Menge*beleghis."VK-Preis")/LZ_tage*LZ_tage_jahr[i]);
                  END;   //xx9
                  IF ((service."Ablaufdatum Serviceleistung"-1>(var_jahr[i])) AND (service."Ablaufdatum Serviceleistung"-1<(var_jahr[i]+365))) THEN BEGIN   //xx10
                    LZ_tage_jahr[i]:=service."Ablaufdatum Serviceleistung"-1-var_jahr[i];
                    var_jahr_wert[i]:=var_jahr_wert[i]+((beleghis.Menge*beleghis."VK-Preis")/LZ_tage*LZ_tage_jahr[i]);
                  END;   //xx10
                END;
              END;
            END;
          END;   //xx3
        UNTIL service.NEXT=0;
      END;   //xx1
      RowNo := 6;
      EnterCell(RowNo,1,'Gesamt Jahr','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(var_jahr_gesamt[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_jahr_gesamt[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_jahr_gesamt[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_jahr_gesamt[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_jahr_gesamt[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_jahr_gesamt[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_jahr_gesamt[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_jahr_gesamt[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_jahr_gesamt[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_jahr_gesamt[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_jahr_gesamt[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_jahr_gesamt[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := 7;
      EnterCell(RowNo,1,'Gesamt Jahr neu','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(var_jahr_neu[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_jahr_neu[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_jahr_neu[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_jahr_neu[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_jahr_neu[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_jahr_neu[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_jahr_neu[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_jahr_neu[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_jahr_neu[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_jahr_neu[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_jahr_neu[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_jahr_neu[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := 8;
      EnterCell(RowNo,1,'Gesamt Jahr verl„ngert','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(var_jahr_verl„ng[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_jahr_verl„ng[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_jahr_verl„ng[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_jahr_verl„ng[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_jahr_verl„ng[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_jahr_verl„ng[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_jahr_verl„ng[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_jahr_verl„ng[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_jahr_verl„ng[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_jahr_verl„ng[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_jahr_verl„ng[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_jahr_verl„ng[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := 10;
      EnterCell(RowNo,1,'im Jahr ablaufend','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(var_jahr_abgelauf[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_jahr_abgelauf[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_jahr_abgelauf[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_jahr_abgelauf[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_jahr_abgelauf[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_jahr_abgelauf[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_jahr_abgelauf[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_jahr_abgelauf[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_jahr_abgelauf[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_jahr_abgelauf[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_jahr_abgelauf[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_jahr_abgelauf[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := 13;
      EnterCell(RowNo,1,'Verl„ngert in % von Ablaufend','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      IF ((var_jahr_verl„ng[1]<>0) AND (var_jahr_abgelauf[1]<>0)) THEN
      EnterCell(RowNo,3,FORMAT(var_jahr_verl„ng[1]/var_jahr_abgelauf[1]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[2]<>0) AND (var_jahr_abgelauf[2]<>0)) THEN
      EnterCell(RowNo,4,FORMAT(var_jahr_verl„ng[2]/var_jahr_abgelauf[2]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[3]<>0) AND (var_jahr_abgelauf[3]<>0)) THEN
      EnterCell(RowNo,5,FORMAT(var_jahr_verl„ng[3]/var_jahr_abgelauf[3]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[4]<>0) AND (var_jahr_abgelauf[4]<>0)) THEN
      EnterCell(RowNo,6,FORMAT(var_jahr_verl„ng[4]/var_jahr_abgelauf[4]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[5]<>0) AND (var_jahr_abgelauf[5]<>0)) THEN
      EnterCell(RowNo,7,FORMAT(var_jahr_verl„ng[5]/var_jahr_abgelauf[5]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[6]<>0) AND (var_jahr_abgelauf[6]<>0)) THEN
      EnterCell(RowNo,8,FORMAT(var_jahr_verl„ng[6]/var_jahr_abgelauf[6]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[7]<>0) AND (var_jahr_abgelauf[7]<>0)) THEN
      EnterCell(RowNo,9,FORMAT(var_jahr_verl„ng[7]/var_jahr_abgelauf[7]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[8]<>0) AND (var_jahr_abgelauf[8]<>0)) THEN
      EnterCell(RowNo,10,FORMAT(var_jahr_verl„ng[8]/var_jahr_abgelauf[8]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[9]<>0) AND (var_jahr_abgelauf[9]<>0)) THEN
      EnterCell(RowNo,11,FORMAT(var_jahr_verl„ng[9]/var_jahr_abgelauf[9]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[10]<>0) AND (var_jahr_abgelauf[10]<>0)) THEN
      EnterCell(RowNo,12,FORMAT(var_jahr_verl„ng[10]/var_jahr_abgelauf[10]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[11]<>0) AND (var_jahr_abgelauf[11]<>0)) THEN
      EnterCell(RowNo,13,FORMAT(var_jahr_verl„ng[11]/var_jahr_abgelauf[11]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[12]<>0) AND (var_jahr_abgelauf[12]<>0)) THEN
      EnterCell(RowNo,14,FORMAT(var_jahr_verl„ng[12]/var_jahr_abgelauf[12]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := 14;
      EnterCell(RowNo,1,'Verl„ngert in % von Jahreseingang','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      IF ((var_jahr_verl„ng[1]<>0) AND (var_jahr_gesamt[1]<>0)) THEN
      EnterCell(RowNo,3,FORMAT(var_jahr_verl„ng[1]/var_jahr_gesamt[1]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[2]<>0) AND (var_jahr_gesamt[2]<>0)) THEN
      EnterCell(RowNo,4,FORMAT(var_jahr_verl„ng[2]/var_jahr_gesamt[2]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[3]<>0) AND (var_jahr_gesamt[3]<>0)) THEN
      EnterCell(RowNo,5,FORMAT(var_jahr_verl„ng[3]/var_jahr_gesamt[3]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[4]<>0) AND (var_jahr_gesamt[4]<>0)) THEN
      EnterCell(RowNo,6,FORMAT(var_jahr_verl„ng[4]/var_jahr_gesamt[4]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[5]<>0) AND (var_jahr_gesamt[5]<>0)) THEN
      EnterCell(RowNo,7,FORMAT(var_jahr_verl„ng[5]/var_jahr_gesamt[5]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[6]<>0) AND (var_jahr_gesamt[6]<>0)) THEN
      EnterCell(RowNo,8,FORMAT(var_jahr_verl„ng[6]/var_jahr_gesamt[6]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[7]<>0) AND (var_jahr_gesamt[7]<>0)) THEN
      EnterCell(RowNo,9,FORMAT(var_jahr_verl„ng[7]/var_jahr_gesamt[7]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[8]<>0) AND (var_jahr_gesamt[8]<>0)) THEN
      EnterCell(RowNo,10,FORMAT(var_jahr_verl„ng[8]/var_jahr_gesamt[8]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[9]<>0) AND (var_jahr_gesamt[9]<>0)) THEN
      EnterCell(RowNo,11,FORMAT(var_jahr_verl„ng[9]/var_jahr_gesamt[9]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[10]<>0) AND (var_jahr_gesamt[10]<>0)) THEN
      EnterCell(RowNo,12,FORMAT(var_jahr_verl„ng[10]/var_jahr_gesamt[10]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[11]<>0) AND (var_jahr_gesamt[11]<>0)) THEN
      EnterCell(RowNo,13,FORMAT(var_jahr_verl„ng[11]/var_jahr_gesamt[11]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      IF ((var_jahr_verl„ng[12]<>0) AND (var_jahr_gesamt[12]<>0)) THEN
      EnterCell(RowNo,14,FORMAT(var_jahr_verl„ng[12]/var_jahr_gesamt[12]*100),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := 16;
      EnterCell(RowNo,1,'Auf Laufzeit verteilt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(var_jahr_wert[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_jahr_wert[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_jahr_wert[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_jahr_wert[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_jahr_wert[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_jahr_wert[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_jahr_wert[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_jahr_wert[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_jahr_wert[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_jahr_wert[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_jahr_wert[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_jahr_wert[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service."Ablaufdatum Serviceleistung",'>%1',Abgrenz_Datum);
      service.SETFILTER(service.Belegdatum,'<=%1',Abgrenz_Datum);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      IF service.FIND('-') THEN BEGIN  //yy1
        REPEAT
          LZ_rest:=0;
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          IF Artikel.FINDFIRST THEN BEGIN  //yy2
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief.Quantity,'<>%1',0);
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            lief.SETFILTER(lief."No.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
            IF lief.FINDFIRST THEN BEGIN  //yy3
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN  //yy4
              END ELSE BEGIN  //yy4_1
                LZ_tage:= (service."Ablaufdatum Serviceleistung"- service.Lizenzdatum-1);
                LZ_tage_stich:=(service."Ablaufdatum Serviceleistung"-Abgrenz_Datum-1);
                LZ_tage_bewert:=0;
                IF LZ_tage_stich>LZ_tage THEN BEGIN   //yy5
                  LZ_tage_bewert := LZ_tage;
                END ELSE BEGIN  ///yy5_1
                  LZ_tage_bewert := LZ_tage_stich;
                END;    //yy5_1
                Sum_ek:=(Sum_ek+ (ROUND(lief."Unit Cost (LCY)"/ LZ_tage*LZ_tage_bewert*lief.Quantity)));
                Sum_vk:=(Sum_vk+ (ROUND(lief."VK-Preis (MW)"/ LZ_tage*LZ_tage_bewert*lief.Quantity)));
      //          Sum_vIF k:=(Sum_vk+ (ROUND(Lief."Unit Price"/ LZ_tage*LZ_tage_bewert*Lief.Quantity)));
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
              END;  //yy 4_1
            END;  //yy2
            beleghis.RESET;
            beleghis.SETFILTER("Belegnr.",'%1',service."Nr.");
            beleghis.SETFILTER("Zeilennr.",'%1',service."Belegzeilennr.");
            beleghis.SETFILTER(Herstellercode,'<>%1&<>%2&<>%3','5710','5720','5730');
            IF beleghis.FINDFIRST THEN BEGIN
              IF (liefnr = beleghis."Belegnr.") AND (liefzeilennr = beleghis."Zeilennr.") THEN BEGIN
              END ELSE BEGIN
                LZ_tage := (service."Ablaufdatum Serviceleistung" - service.Lizenzdatum - 1);
                LZ_tage_stich := (service."Ablaufdatum Serviceleistung" - Abgrenz_Datum - 1);
                LZ_tage_bewert := 0;
                IF LZ_tage_stich > LZ_tage THEN BEGIN
                  LZ_tage_bewert := LZ_tage;
                END ELSE BEGIN
                  LZ_tage_bewert := LZ_tage_stich;
                END;
                Sum_ek := (Sum_ek + (ROUND(beleghis."Einstandspreis MW" / LZ_tage * LZ_tage_bewert * beleghis.Menge)));
                Sum_vk := (Sum_vk + (ROUND(beleghis."VK-Preis" / LZ_tage * LZ_tage_bewert * beleghis.Menge)));
                liefnr := beleghis."Belegnr.";
                liefzeilennr := beleghis."Zeilennr.";
              END;
            END;
          END;
        UNTIL service.NEXT=0;
      END;   //yy1

      RowNo := 20;
      EnterCell(RowNo,1,'Abgrenzung per','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := 21;
      EnterCell(RowNo,1,FORMAT(Abgrenz_Datum),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      RowNo := 22;
      EnterCell(RowNo,1,'Abgrenz_Ek','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(Sum_ek),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := 23;
      EnterCell(RowNo,1,'Abgrenz_Vk','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(Sum_vk),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service."Dauer Serviceleistung",'%1','12M');
      service.SETFILTER(service.Belegdatum,'%1..%2',PeriodStartDate[1],Abgrenz_Datum);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      IF service.FIND('-') THEN BEGIN
        REPEAT
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          IF Artikel.FINDFIRST THEN BEGIN
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief.Quantity,'<>%1',0);
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            lief.SETFILTER(lief."No.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
            IF lief.FINDFIRST THEN BEGIN
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN
              END ELSE BEGIN
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
                sum_gj_12:=sum_gj_12 + (lief.Quantity* lief."VK-Preis (MW)");
              END;
            END;
          END;
        UNTIL service.NEXT=0;
      END;
      RowNo := 25;
      EnterCell(RowNo,1,'GJ_12M:','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(sum_gj_12),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service."Dauer Serviceleistung",'>%1&<%2','12M','36M');
      service.SETFILTER(service.Belegdatum,'%1..%2',PeriodStartDate[1],Abgrenz_Datum);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      IF service.FIND('-') THEN BEGIN
        REPEAT
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          IF Artikel.FINDFIRST THEN BEGIN
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief.Quantity,'<>%1',0);
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            lief.SETFILTER(lief."No.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
            IF lief.FINDFIRST THEN BEGIN
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN
              END ELSE BEGIN
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
                sum_gj_36:=sum_gj_36 + (lief.Quantity* lief."VK-Preis (MW)");
              END;
            END;
          END;
        UNTIL service.NEXT=0;
      END;
      RowNo := 26;
      EnterCell(RowNo,1,'GJ_13-35M:','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(sum_gj_36),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service."Dauer Serviceleistung",'>=%1','36M');
      service.SETFILTER(service.Belegdatum,'%1..%2',PeriodStartDate[1],Abgrenz_Datum);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      IF service.FIND('-') THEN BEGIN
        REPEAT
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          IF Artikel.FINDFIRST THEN BEGIN
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            lief.SETFILTER(lief.Quantity,'<>%1',0);
            lief.SETFILTER(lief."No.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
            IF lief.FINDFIRST THEN BEGIN
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN
              END ELSE BEGIN
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
                sum_gj_sonst:=sum_gj_sonst + (lief.Quantity* lief."VK-Preis (MW)");
              END;
            END;
          END;
        UNTIL service.NEXT=0;
      END;
      RowNo := 27;
      EnterCell(RowNo,1,'GJ_36M +:','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(sum_gj_sonst),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service.Belegdatum,'>=%1&<=%2',PeriodStartDate[1],Abgrenz_Datum);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      IF service.FIND('-') THEN BEGIN
        REPEAT
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          IF Artikel.FINDFIRST THEN BEGIN
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief.Quantity,'<>%1',0);
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            lief.SETFILTER(lief."No.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
            IF lief.FINDFIRST THEN BEGIN
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN
              END ELSE BEGIN
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
                sum_gj_gesamt:=sum_gj_gesamt +(lief.Quantity* lief."VK-Preis (MW)");
              END;
            END;
          END;
        UNTIL service.NEXT=0;
      END;
      RowNo := 28;
      EnterCell(RowNo,1,'GJ_Gesamt:','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(sum_gj_gesamt),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      CloseExcel('Daten_Nav_Champs_Zeilen_2020','Daten_Nav_Champs_Zeilen_2020','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_GuV@1000000005();
    BEGIN
      FOR i := 1 TO 13 DO

      PeriodStartDate[i + 1] := CALCDATE('1M',PeriodStartDate[i]);
      PeriodStartDate[14] := 31129999D;
      CreateExcel;
      RowNo := 1;
      EnterCell(RowNo,1,'Konto-Nr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Kontoname','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);

      sachkonten.RESET;
      sachkonten.SETRANGE(sachkonten."No.",'4000','7999');
      IF sachkonten.FIND('-') THEN BEGIN
        REPEAT
          FOR i:=1 TO 12 DO BEGIN
            var_balance[i]:=0;
          END;
          var_balance_gesamt_konto := 0;
          sachposten.RESET;
          sachposten.SETRANGE(sachposten."G/L Account No.",sachkonten."No.");
          IF sachposten.FIND('-') THEN BEGIN
            FOR i:=1 TO 12 DO BEGIN
              sachposten.SETRANGE(sachposten."Posting Date",PeriodStartDate[i],(PeriodStartDate[i+1] - 1));
              IF sachposten.FIND('-') THEN BEGIN
                REPEAT
                  var_balance[i] := var_balance[i] + sachposten.Amount;
                  var_balance_total[i] := var_balance_total[i] + sachposten.Amount;
                  var_balance_total_summe := var_balance_total_summe + sachposten.Amount;
                UNTIL sachposten.NEXT=0;
              END;
              var_balance_gesamt_konto := var_balance_gesamt_konto + var_balance[i];
            END;
            IF var_balance_gesamt_konto<>0 THEN BEGIN
              RowNo := RowNo + 1;
              EnterCell(RowNo,1,sachkonten."No.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
              EnterCell(RowNo,2,sachkonten.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
              EnterCell(RowNo,3,FORMAT(var_balance_gesamt_konto),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
              EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            END;
          END;
        UNTIL sachkonten.NEXT=0;
      END;
      EnterCell(160,2,'Summe','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(160,3,FORMAT(var_balance_total_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(160,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      CloseExcel('Daten_Nav_GuV','Daten_Nav_GuV','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_Bil@1000000006();
    BEGIN
      CreateExcel;
      RowNo := 1;
      EnterCell(RowNo,1,'Nr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Name','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Saldo','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      sachkonten.RESET;
      sachkonten.SETRANGE(sachkonten."No.",'0001','3999');
      IF sachkonten.FIND('-') THEN BEGIN
        REPEAT
          v_sachpostsum:=0;
          sachposten.RESET;
          sachposten.SETRANGE(sachposten."G/L Account No.",sachkonten."No.");
          sachposten.SETRANGE(sachposten."Posting Date",010100D,Abgrenz_Datum);
          IF sachposten.FIND('-') THEN BEGIN
            REPEAT
              v_sachpostsum:=v_sachpostsum+sachposten.Amount;
            UNTIL sachposten.NEXT=0;
          END;
          IF v_sachpostsum<>0 THEN BEGIN
            RowNo := RowNo + 1;
            EnterCell(RowNo,1,sachkonten."No.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,sachkonten.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_sachpostsum),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
        UNTIL sachkonten.NEXT=0;
      END;
      CloseExcel('Daten_Nav_Bil','Daten_Nav_Bil','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_Systeme@1000000007();
    BEGIN
      //PeriodStartDate[1] := 010716D;
      FOR i := 1 TO 13 DO
      PeriodStartDate[i + 1] := CALCDATE('1M',PeriodStartDate[i]);
      PeriodStartDate[14] := 31129999D;

      CreateExcel;
      RowNo := 11;
      EnterCell(RowNo,1,'VK-Ums„tze nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);                                                // <- Import in excel ab Zeile 2
      RowNo := 12;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
                                                       // <- Import in excel ab Zeile 2
      ///Hersteller  1 Teil VK
      //////********************************************************************************************
      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'%1|%2|%3|%4','20','59','82','85');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
          //Rechnungszeilen verarbeiten
          FOR i := 1 TO 12 DO BEGIN
            VKRZ.RESET;
            VKRZ.SETRANGE(VKRZ."Manufacturer Code",Herstell.Code);
            VKRZ.SETRANGE(VKRZ."Posting Date",PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            VKRZ.SETRANGE(VKRZ.Type,VKRZ.Type::Item);
            VKRZ.SETFILTER(VKRZ.Quantity,'>%1',0);
            VKRZ.SETFILTER(VKRZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
            IF VKRZ.FIND('-') THEN BEGIN
              REPEAT
                IF  VKRZ."VK-Preis (MW)"=VKRZ."Unit Price" THEN BEGIN
                  var_balance[i] := var_balance[i] +( VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  v_summe:=v_summe + (VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  v_summe_total:= v_summe_total + (VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  var_balance_total[i] := var_balance_total[i] + (VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  v_sum_au:=v_sum_au + ((VKRZ.Quantity)*(VKRZ."Unit Cost (LCY)"));
                END ELSE BEGIN
                  IF VKRZ.Einkaufsw„hrungsfaktor <> 0 THEN BEGIN
      //            Diese Zeile stimmt nur, wenn Einkaufrechnungsfaktor identisch mit Verkaufsw„hrungsfaktor aus dem VK-Kopf  **********************
                    v_sum_au:=v_sum_au + ((VKRZ.Quantity)*(VKRZ."Unit Cost (LCY)"));
                    var_balance[i] := var_balance[i] + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                    v_summe:=v_summe + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                    v_summe_total:= v_summe_total + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                    var_balance_total[i] := var_balance_total[i] + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                  END ELSE BEGIN
                    v_sum_au:=v_sum_au + ((VKRZ.Quantity)*(VKRZ."Unit Cost (LCY)"));
                    var_balance[i] := var_balance[i] + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                    v_summe:=v_summe + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                    v_summe_total:= v_summe_total + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                    var_balance_total[i] := var_balance_total[i] + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                  END;
                END;
              UNTIL VKRZ.NEXT = 0;
            END ELSE BEGIN
              var_balance[i] := 0;
            END;
          END;
          // Anzeigen wenn RE fr 20 Wildixvorliegt
          IF Herstell.Code='20' THEN BEGIN
            RowNo := 13;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          // Anzeigen wenn RE fr 59 ACS vorliegt
          IF Herstell.Code='59' THEN BEGIN
            RowNo := 14;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          // Anzeigen wenn RE fr 82 Splicecom vorliegt
          IF Herstell.Code='82' THEN BEGIN
            RowNo := 15;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          // Anzeigen wenn RE fr 85 Ferrari vorliegt
          IF Herstell.Code='85' THEN BEGIN
            RowNo := 16;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
        UNTIL Herstell.NEXT=0;
      END;
      //Salesperson/Purchaser - OnPostDataItem()
      RowNo := 19;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'VK-Rechnung','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(1,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(1,2,'VK-Rechnung','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(1,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := 21;
      // Gutschriftszeilen verarbeiten ************************************************************************************************
      EnterCell(RowNo,1,'VK-Gutschriften nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := 22;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);

      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'%1|%2|%3|%4','20','59','82','85');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
          FOR u := 1 TO 12 DO BEGIN
            VKGK.RESET;
            VKGK.SETFILTER(VKGK."Posting Date",'%1..%2',PeriodStartDate[u],PeriodStartDate[u+1] - 1);
            IF VKGK.FIND('-') THEN BEGIN
              REPEAT
                VKGZ.RESET;
                VKGZ.SETRANGE(VKGZ."Document No.",VKGK."No.");
                VKGZ.SETRANGE(VKGZ."Manufacturer Code",Herstell.Code);
                VKGZ.SETRANGE(VKGZ.Type,VKRZ.Type::Item);
                VKGZ.SETFILTER(VKGZ.Quantity,'<>%1',0);
                VKGZ.SETFILTER(VKGZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
                IF VKGZ.FIND('-') THEN BEGIN
                  REPEAT
                    var_balance[u] := var_balance[u] + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                    v_summe:=v_summe + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                    v_summe_total:= v_summe_total + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                    var_balance_total[u] := var_balance_total[u] + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                  UNTIL VKGZ.NEXT = 0;
                END;
              UNTIL VKGK.NEXT = 0;
            END;
          END;
      //  Anzeigen wenn GU fr 20 Wildix  vorliegt
          IF Herstell.Code='20' THEN BEGIN
            RowNo := 23;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn GU fr 59 ACS  vorliegt
          IF Herstell.Code='59' THEN BEGIN
            RowNo := 24;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn GU fr 82 Splicecom  vorliegt
          IF Herstell.Code='82' THEN BEGIN
            RowNo := 25;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn GU fr 85 Ferrari  vorliegt
          IF Herstell.Code='85' THEN BEGIN
            RowNo := 26;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
        UNTIL Herstell.NEXT=0;
      END;
      RowNo := 29;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'VK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(2,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(2,2,'VK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(2,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      ///Hersteller  2 Teil EK
      //////********************************************************************************************
      RowNo := 31;
      EnterCell(RowNo,1,'EK-Preise aus Rechnungsums„tzen nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);

      RowNo := 32;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);

      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'%1|%2|%3|%4','20','59','82','85');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
      //  EK-Preise aus Rechnungszeilen verarbeiten
          FOR i := 1 TO 12 DO BEGIN
            VKRZ.RESET;
            VKRZ.SETRANGE(VKRZ."Manufacturer Code",Herstell.Code);
            VKRZ.SETRANGE(VKRZ."Posting Date",PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            VKRZ.SETRANGE(VKRZ.Type,VKRZ.Type::Item);
            VKRZ.SETFILTER(VKRZ.Quantity,'<>%1',0);
            VKRZ.SETFILTER(VKRZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
            IF VKRZ.FIND('-') THEN BEGIN
              REPEAT
                var_balance[i] := var_balance[i] +(VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
                v_summe:=v_summe + (VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
                v_summe_total:= v_summe_total + (VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
                var_balance_total[i] := var_balance_total[i] + (VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
              UNTIL VKRZ.NEXT = 0;
            END ELSE BEGIN
              var_balance[i] := 0;
            END;
          END;

      //  Anzeigen wenn Einkauf-Ums„tze fr 20 Wildix  vorliegt
          IF Herstell.Code='20' THEN BEGIN
            RowNo := 33;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn Einkauf-Ums„tze fr 59 ACS vorliegt
          IF Herstell.Code='59' THEN BEGIN
            RowNo := 34;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn Einkauf-Ums„tze fr 82 Splicecom  vorliegt
          IF Herstell.Code='82' THEN BEGIN
            RowNo := 35;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn Einkauf-Ums„tze fr 85 Ferrari  vorliegt
          IF Herstell.Code='85' THEN BEGIN
            RowNo := 36;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
        UNTIL Herstell.NEXT=0;
      END;
      //Salesperson/Purchaser - OnPostDataItem()
      RowNo := 39;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'EK-Rechnungen','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(3,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(3,2,'EK-Rechnungen','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(3,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      // Gutschriftszeilen verarbeiten************************************************************************************
      RowNo := 41;
      EnterCell(RowNo,1,'EK-Preise aus VK-Gutschriften nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := 42;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);

      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'%1|%2|%3|%4','20','59','82','85');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
          FOR u := 1 TO 12 DO BEGIN
            VKGK.RESET;
            VKGK.SETFILTER(VKGK."Posting Date",'%1..%2',PeriodStartDate[u],PeriodStartDate[u+1] - 1);
            IF VKGK.FIND('-') THEN BEGIN
              REPEAT
                VKGZ.RESET;
                VKGZ.SETRANGE(VKGZ."Document No.",VKGK."No.");
                VKGZ.SETRANGE(VKGZ."Manufacturer Code",Herstell.Code);
                VKGZ.SETRANGE(VKGZ.Type,VKRZ.Type::Item);
                VKGZ.SETFILTER(VKGZ.Quantity,'<>%1',0);
                VKGZ.SETFILTER(VKGZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
                IF VKGZ.FIND('-') THEN BEGIN
                  REPEAT
                    var_balance[u] := var_balance[u] + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                    v_summe:=v_summe + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                    v_summe_total:= v_summe_total + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                    var_balance_total[u] := var_balance_total[u] + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                  UNTIL VKGZ.NEXT = 0;
                END;
              UNTIL VKGK.NEXT = 0;
            END;
          END;
      //  Anzeigen wenn Einkauf-Gutschriften fr 20 Wildix  vorliegen
          IF Herstell.Code='20' THEN BEGIN
            RowNo := 43;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn Einkauf-Gutschriften fr 59 ACS  vorliegen
          IF Herstell.Code='59' THEN BEGIN
            RowNo := 44;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn Einkauf-Gutschriften fr 82 Splicecom  vorliegen
          IF Herstell.Code='82' THEN BEGIN
            RowNo := 45;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  Anzeigen wenn Einkauf-Gutschriften fr 85 Ferrari vorliegen
          IF Herstell.Code='85' THEN BEGIN
            RowNo := 46;
            EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
        UNTIL Herstell.NEXT=0;
      END;
      RowNo := 49;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'EK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(4,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(4,2,'EK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(4,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      CloseExcel('Daten_Nav_Systeme','Daten_Nav_Systeme','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_Dienstleistung@1000000008();
    BEGIN
      //PeriodStartDate[1] := 010715D;
      FOR i := 1 TO 13 DO
      PeriodStartDate[i + 1] := CALCDATE('1M',PeriodStartDate[i]);
      PeriodStartDate[14] := 31129999D;

      CreateExcel;
      RowNo := 20;
      EnterCell(RowNo,1,'VK-Ums„tze nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);                                                // <- Import in excel ab Zeile 2

      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);

      RowNo := RowNo + 1;
      ///Hersteller  1 Teil VK
      //////********************************************************************************************
      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'52|53|57*|86|87|96');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
      //  Rechnungszeilen verarbeiten
          FOR i := 1 TO 12 DO BEGIN
            VKRZ.RESET;
            VKRZ.SETRANGE(VKRZ."Manufacturer Code",Herstell.Code);
            VKRZ.SETRANGE(VKRZ."Posting Date",PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            VKRZ.SETRANGE(VKRZ.Type,VKRZ.Type::Item);
            VKRZ.SETFILTER(VKRZ.Quantity,'>%1',0);
            VKRZ.SETFILTER(VKRZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
            IF VKRZ.FIND('-') THEN BEGIN
              REPEAT
                IF VKRZ."VK-Preis (MW)"=VKRZ."Unit Price" THEN BEGIN
                  var_balance[i] := var_balance[i] +( VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  v_summe:=v_summe + (VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  v_summe_total:= v_summe_total + (VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  var_balance_total[i] := var_balance_total[i] + (VKRZ."VK-Preis (MW)"*VKRZ.Quantity);
                  v_sum_au:=v_sum_au + ((VKRZ.Quantity)*(VKRZ."Unit Cost (LCY)"));
                END ELSE BEGIN
                  IF VKRZ.Einkaufsw„hrungsfaktor <> 0 THEN BEGIN
      //            Diese Zeile stimmt nur, wenn Einkaufrechnungsfaktor identisch mit Verkaufsw„hrungsfaktor aus dem VK-Kopf  **********************
                    v_sum_au:=v_sum_au + ((VKRZ.Quantity)*(VKRZ."Unit Cost (LCY)"));
                    var_balance[i] := var_balance[i] + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                    v_summe:=v_summe + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                    v_summe_total:= v_summe_total + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                    var_balance_total[i] := var_balance_total[i] + ((VKRZ."Unit Price") / (VKRZ.Einkaufsw„hrungsfaktor)* (VKRZ.Quantity));
                  END ELSE BEGIN
                    v_sum_au:=v_sum_au + ((VKRZ.Quantity)*(VKRZ."Unit Cost (LCY)"));
                    var_balance[i] := var_balance[i] + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                    v_summe:=v_summe + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                    v_summe_total:= v_summe_total + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                    var_balance_total[i] := var_balance_total[i] + ((VKRZ."Unit Price") * (VKRZ.Quantity));
                  END;
                END;
              UNTIL VKRZ.NEXT = 0;
            END ELSE BEGIN
              var_balance[i] := 0;
            END;
          END;
          EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  Anzeigen wenn AE vorliegt
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          RowNo := RowNo + 1;
        UNTIL Herstell.NEXT=0;
      END;
      //Salesperson/Purchaser - OnPostDataItem()
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'VK-Rechnungen','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(1,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(1,2,'VK-Rechnungen','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(1,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(1,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      RowNo := RowNo + 1;
      // Gutschriftszeilen verarbeiten
      RowNo := 40;
      EnterCell(RowNo,1,'VK-Gutschriften nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      RowNo := RowNo + 1;
      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'52|53|57*|86|87|96');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
          FOR u := 1 TO 12 DO BEGIN
            VKGK.RESET;
            VKGK.SETFILTER(VKGK."Posting Date",'%1..%2',PeriodStartDate[u],PeriodStartDate[u+1] - 1);
            IF VKGK.FIND('-') THEN BEGIN
              REPEAT
                VKGZ.RESET;
                VKGZ.SETRANGE(VKGZ."Document No.",VKGK."No.");
                VKGZ.SETRANGE(VKGZ."Manufacturer Code",Herstell.Code);
                VKGZ.SETRANGE(VKGZ.Type,VKRZ.Type::Item);
                VKGZ.SETFILTER(VKGZ.Quantity,'<>%1',0);
                VKGZ.SETFILTER(VKGZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
                IF VKGZ.FIND('-') THEN BEGIN
                  REPEAT
                    var_balance[u] := var_balance[u] + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                    v_summe:=v_summe + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                    v_summe_total:= v_summe_total + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                    var_balance_total[u] := var_balance_total[u] + (VKGZ."VK-Preis (MW)"*VKGZ.Quantity*(-1));
                  UNTIL VKGZ.NEXT = 0;
                END;
              UNTIL VKGK.NEXT = 0;
            END;
          END;
          EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          RowNo := RowNo + 1;
        UNTIL Herstell.NEXT=0;
      END;
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'VK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(2,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(2,2,'VK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(2,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(2,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;
      ///Hersteller  2 Teil EK
      //////********************************************************************************************
      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      RowNo := 60;
      EnterCell(RowNo,1,'EK-Ums„tze nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      RowNo := RowNo + 1;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'52|53|57*|86|87|96');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
      //  EK-Rechnungszeilen verarbeiten
          FOR i := 1 TO 12 DO BEGIN
            VKRZ.RESET;
            VKRZ.SETRANGE(VKRZ."Manufacturer Code",Herstell.Code);
            VKRZ.SETRANGE(VKRZ."Posting Date",PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            VKRZ.SETRANGE(VKRZ.Type,VKRZ.Type::Item);
            VKRZ.SETFILTER(VKRZ.Quantity,'<>%1',0);
            VKRZ.SETFILTER(VKRZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
            IF VKRZ.FIND('-') THEN BEGIN
              REPEAT
                var_balance[i] := var_balance[i] +(VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
                v_summe:=v_summe + (VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
                v_summe_total:= v_summe_total + (VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
                var_balance_total[i] := var_balance_total[i] + (VKRZ."Unit Cost (LCY)"*VKRZ.Quantity);
              UNTIL VKRZ.NEXT = 0;
            END ELSE BEGIN
              var_balance[i] := 0;
            END;
          END;

      //  Anzeigen wenn AE vorliegt
          EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
      //  IF v_summe <> 0 THEN BEGIN
          RowNo := RowNo + 1;
        UNTIL Herstell.NEXT=0;
      END;
      //Salesperson/Purchaser - OnPostDataItem()
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'EK-Rechnungen','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(3,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(3,2,'EK-Rechnungen','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(3,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(3,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;
      // Gutschriftszeilen verarbeiten
      RowNo := 80;
      EnterCell(RowNo,1,'EK-Gutschriften nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Herstell-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      RowNo := RowNo + 1;
      v_summe_total:=0;
      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'52|53|57*|86|87|96');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;
          FOR u := 1 TO 12 DO BEGIN
            VKGK.RESET;
            VKGK.SETFILTER(VKGK."Posting Date",'%1..%2',PeriodStartDate[u],PeriodStartDate[u+1] - 1);
            IF VKGK.FIND('-') THEN BEGIN
              REPEAT
                VKGZ.RESET;
                VKGZ.SETRANGE(VKGZ."Document No.",VKGK."No.");
                VKGZ.SETRANGE(VKGZ."Manufacturer Code",Herstell.Code);
                VKGZ.SETRANGE(VKGZ.Type,VKRZ.Type::Item);
                VKGZ.SETFILTER(VKGZ.Quantity,'<>%1',0);
                VKGZ.SETFILTER(VKGZ."Location Code",'%1|%2|%3','ZENT','KONSI','ERSATZ');
                IF VKGZ.FIND('-') THEN BEGIN
                  REPEAT
                    var_balance[u] := var_balance[u] + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                    v_summe:=v_summe + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                    v_summe_total:= v_summe_total + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                    var_balance_total[u] := var_balance_total[u] + (VKGZ."Unit Cost (LCY)"*VKGZ.Quantity*(-1));
                  UNTIL VKGZ.NEXT = 0;
                END;
              UNTIL VKGK.NEXT = 0;
            END;
          END;
          EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          RowNo := RowNo + 1;
        UNTIL Herstell.NEXT=0;
      END;
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'EK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      EnterCell(4,1,'Gesamt','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(4,2,'EK-Gutschriften','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(4,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(4,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'#,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      CloseExcel('Daten_Nav_Dienstleistung','Daten_Nav_Dienstleistung','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_UM@1000000009();
    BEGIN
      v_summe:=0;
      v_summe_total:=0;
      FOR i := 1 TO 13 DO

      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;

      PeriodStartDate[i + 1] := CALCDATE('1M',PeriodStartDate[i]);
      PeriodStartDate[14] := 31129999D;
      CreateExcel;
      RowNo := 1;
      EnterCell(RowNo,1,'Umsatzerl”se Verk„ufercode nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Verk„ufer','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Betreuer','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      RowNo := RowNo + 1;
      ///salesperson  1 Teil
      //////********************************************************************************************
      vkcode.RESET;
      vkcode.SETRANGE(vkcode."Kenner Aussen_Innendienst",'A','B');
      IF vkcode.FIND('-') THEN BEGIN
        REPEAT
          vkcode1.RESET;
          vkcode1.SETRANGE(vkcode1."Kenner Aussen_Innendienst",'A','B');
          IF vkcode1.FIND('-') THEN BEGIN
            REPEAT
              v_summe:=0;
              var_balance[1]:=0;
              var_balance[2]:=0;
              var_balance[3]:=0;
              var_balance[4]:=0;
              var_balance[5]:=0;
              var_balance[6]:=0;
              var_balance[7]:=0;
              var_balance[8]:=0;
              var_balance[9]:=0;
              var_balance[10]:=0;
              var_balance[11]:=0;
              var_balance[12]:=0;
              FOR i := 1 TO 12 DO BEGIN
                Belege.RESET;
                Belege.SETRANGE(Belege.Verk„ufercode,vkcode.Code);
                Belege.SETRANGE(Belege."Betreuer Innendienst",vkcode1.Code);
                Belege.SETRANGE(Belege.Belegdatum,PeriodStartDate[i],PeriodStartDate[i+1] - 1);
                Belege.SETFILTER(Belege.Belegart,'%1|%2',Belege.Belegart::Invoice,Belege.Belegart::"Credit Memo");
                IF Belege.FIND('-') THEN BEGIN
                  REPEAT
                    IF Belege.Belegart=Belege.Belegart::Invoice THEN BEGIN
                      var_balance[i] := var_balance[i] + Belege."Betrag MW ohne Mwst.";
                      v_summe:=v_summe + Belege."Betrag MW ohne Mwst.";
                      v_summe_total:= v_summe_total + Belege."Betrag MW ohne Mwst.";
                    END;
                    IF Belege.Belegart=Belege.Belegart::"Credit Memo" THEN BEGIN
                      var_balance[i] := var_balance[i] + (Belege."Betrag MW ohne Mwst."*(-1));
                      v_summe:=v_summe + (Belege."Betrag MW ohne Mwst."*(-1));
                      v_summe_total:= v_summe_total + (Belege."Betrag MW ohne Mwst."*(-1));
                    END;
                  UNTIL Belege.NEXT = 0;
                END;
              END;
              FOR i := 1 TO 12 DO BEGIN
                var_balance_total[i] := var_balance_total[i] + var_balance[i];
              END;
      //      Anzeigen wenn AE vorliegt
              IF v_summe <> 0 THEN BEGIN
                EnterCell(RowNo,1,vkcode.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
                EnterCell(RowNo,2,vkcode1.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
                EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
                RowNo := RowNo + 1;
              END;
            UNTIL vkcode1.NEXT=0;
          END;
          IF v_summe <> 0 THEN BEGIN
            RowNo := RowNo + 1;
          END;
        UNTIL vkcode.NEXT=0;
      END;
      RowNo := 37;
      EnterCell(RowNo,1,'Umsatz Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);

      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      Belege.RESET;
      Belege.SETRANGE(Belege.Belegdatum,PeriodStartDate[i],PeriodStartDate[i+1] - 1);
      Belege.SETFILTER(Belege.Belegart,'%1|%2',Belege.Belegart::Invoice,Belege.Belegart::"Credit Memo");
      Belege.SETFILTER(Belege.Verk„ufercode,'%1','');
      // Belege.SETRANGE(Belege."Betreuer Innendienst",vkcode1.Code);
      IF Belege.FINDFIRST THEN BEGIN
        v_kein_VCode:=Belege."Belegnr.";
      END;
      Belege.RESET;
      Belege.SETRANGE(Belege.Belegdatum,PeriodStartDate[i],PeriodStartDate[i+1] - 1);
      Belege.SETFILTER(Belege.Belegart,'%1|%2',Belege.Belegart::Invoice,Belege.Belegart::"Credit Memo");
      Belege.SETFILTER(Belege."Betreuer Innendienst",'%1','');
      IF Belege.FINDFIRST THEN BEGIN
        v_kein_VCode:=Belege."Belegnr.";
      END;
      IF v_kein_VCode='' THEN BEGIN
      END ELSE BEGIN
        EnterCell(RowNo,1,'Es gibt Belege ohne Verk„ufer und/oder Bearbeiter Code' + v_kein_VCode,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      END;

      CloseExcel('Daten_Nav_UM','Daten_Nav_UM','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_Hersteller@1000000010();
    BEGIN
      CreateExcel;
      RowNo := 1;
      EnterCell(RowNo,1,'Hersteller Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Hersteller Name','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Hersteller Kurzbezeichnung','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,'Gesch„ftsbereich','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := RowNo + 1;
      Herstell.RESET;
      Herstell.SETFILTER(Herstell.Code,'%1..%2','00','9999');
      Herstell.SETFILTER(Herstell.Name,'<>%1','');
      IF Herstell.FIND('-') THEN BEGIN
        REPEAT
          EnterCell(RowNo,1,Herstell.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,2,Herstell.Name,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,3,Herstell.Herstellerkurzname,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          EnterCell(RowNo,4,FORMAT(Herstell.Gesch„ftsbereich),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          RowNo := RowNo + 1;
        UNTIL Herstell.NEXT=0;
      END;
      CloseExcel('Daten_Nav_Hersteller','Daten_Nav_Hersteller','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_Nav_AE@1000000011();
    BEGIN

      FOR i := 1 TO 13 DO
      PeriodStartDate[i + 1] := CALCDATE('1M',PeriodStartDate[i]);
      PeriodStartDate[14] := 31129999D;

      var_balance_total[1]:=0;
      var_balance_total[2]:=0;
      var_balance_total[3]:=0;
      var_balance_total[4]:=0;
      var_balance_total[5]:=0;
      var_balance_total[6]:=0;
      var_balance_total[7]:=0;
      var_balance_total[8]:=0;
      var_balance_total[9]:=0;
      var_balance_total[10]:=0;
      var_balance_total[11]:=0;
      var_balance_total[12]:=0;

      var_balance_monat[1]:=0;
      var_balance_monat[2]:=0;
      var_balance_monat[3]:=0;
      var_balance_monat[4]:=0;
      var_balance_monat[5]:=0;
      var_balance_monat[6]:=0;
      var_balance_monat[7]:=0;
      var_balance_monat[8]:=0;
      var_balance_monat[9]:=0;
      var_balance_monat[10]:=0;
      var_balance_monat[11]:=0;
      var_balance_monat[12]:=0;

      v_summe_total:= 0;

      CreateExcel;
      RowNo := 1;
      EnterCell(RowNo,1,'Auftragseingang nach Perioden','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'VK-Code','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,'Name','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,'Gesamt','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,4,FORMAT(PeriodStartDate[1]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,5,FORMAT(PeriodStartDate[2]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,6,FORMAT(PeriodStartDate[3]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,7,FORMAT(PeriodStartDate[4]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,8,FORMAT(PeriodStartDate[5]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,9,FORMAT(PeriodStartDate[6]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,10,FORMAT(PeriodStartDate[7]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,11,FORMAT(PeriodStartDate[8]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,12,FORMAT(PeriodStartDate[9]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,13,FORMAT(PeriodStartDate[10]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,14,FORMAT(PeriodStartDate[11]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      EnterCell(RowNo,15,FORMAT(PeriodStartDate[12]),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      RowNo := RowNo + 1;
      ///salesperson  1 Teil
      /////********************************************************************************************
      vkcode.RESET;
      vkcode.SETFILTER(vkcode.Code,'<>%1','ALLE');
      //vkcode.SETFILTER(vkcode.Code,'<>%1','MULTI');
      IF vkcode.FINDFIRST THEN BEGIN
        REPEAT
          v_summe:=0;
          var_balance[1]:=0;
          var_balance[2]:=0;
          var_balance[3]:=0;
          var_balance[4]:=0;
          var_balance[5]:=0;
          var_balance[6]:=0;
          var_balance[7]:=0;
          var_balance[8]:=0;
          var_balance[9]:=0;
          var_balance[10]:=0;
          var_balance[11]:=0;
          var_balance[12]:=0;



      {
          FOR i := 1 TO 12 DO BEGIN
            AU_PER.RESET;
            AU_PER.SETFILTER(AU_PER.Verk„ufercode,'%1',vkcode.Code);
            AU_PER.SETFILTER(Periodendatum,'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            AU_PER.SETFILTER(AU_PER.Art,'%1|%2','AU','GU');
            AU_PER.SETFILTER(AU_PER.Deaktiv,'%1',FALSE);
            IF AU_PER.FINDFIRST THEN BEGIN
              REPEAT
                var_balance[i] := var_balance[i] + AU_PER.Wert_MW;
                v_summe:=v_summe + AU_PER.Wert_MW;
                v_summe_total:= v_summe_total + AU_PER.Wert_MW;
              UNTIL AU_PER.NEXT = 0;
            END ELSE BEGIN
              var_balance[i] := 0;
            END;
          END;
      }

          FOR i := 1 TO 12 DO BEGIN
            AEMTL.RESET;
            AEMTL.SETFILTER(AEMTL.Vertreter,'%1',vkcode.Code);
      //      AEMTL.SETFILTER(AEMTL.Datum,'%1..%2',01092017D,30092017D);
            AEMTL.SETFILTER(AEMTL.Datum,'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            AEMTL.SETFILTER(AEMTL.Belegart,'%1|%2|%3','AMTL','AEMT','GUMT');
      //      AEMTL.SETFILTER(AEMTL.Status,'%1','AE');
            IF AEMTL.FINDFIRST THEN BEGIN
              REPEAT
                var_balance[i] := var_balance[i] + AEMTL."Betrag in EUR";
                  var_balance_monat[i] := var_balance_monat[i] + AEMTL."Betrag in EUR";
                  var_balance_total[i] := var_balance_total[i] + AEMTL."Betrag in EUR";
                v_summe:=v_summe + AEMTL."Betrag in EUR";
       //         IF AEMTL.Vertreter='ESK' THEN BEGIN
                  v_summe_total:= v_summe_total + AEMTL."Betrag in EUR";
       //        END;
              UNTIL AEMTL.NEXT = 0;
            END ELSE BEGIN

              var_balance[i] := 0;

            END;
          END;
          FOR i := 1 TO 12 DO BEGIN
      //      var_balance_monat[i] := var_balance_monat[i] + var_balance[i];
      //      var_balance_total[i] := var_balance_total[i] + var_balance[i];
          END;

      //  Anzeigen wenn AE vorliegt
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,1,vkcode.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,vkcode."First name",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_balance[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_balance[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_balance[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_balance[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_balance[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_balance[6]),'',FALSE,FALSE,FALSE,'###,##,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_balance[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_balance[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_balance[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_balance[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_balance[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_balance[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;


          IF v_summe <> 0 THEN BEGIN
            RowNo := RowNo + 1;
          END;
        UNTIL vkcode.NEXT=0;
      END;

      //Salesperson/Purchaser - OnPostDataItem()
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'AU Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;

      EnterCell(100,1,'AU Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(100,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,4,FORMAT(var_balance_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,5,FORMAT(var_balance_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,6,FORMAT(var_balance_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,7,FORMAT(var_balance_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,8,FORMAT(var_balance_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,9,FORMAT(var_balance_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,10,FORMAT(var_balance_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,11,FORMAT(var_balance_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,12,FORMAT(var_balance_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,13,FORMAT(var_balance_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,14,FORMAT(var_balance_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(100,15,FORMAT(var_balance_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;


      ////**********************************************************************************************
      ///////SP 2 Teil
      ///  On Pre
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Rahmenauftragseingang','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      // Sheet.Range('A'+j).Value := 'Rahmenauftragseingang:';
      RowNo := RowNo + 1;

      //// On after get Record SP

      vkcode.RESET;
      vkcode.SETFILTER(vkcode.Code,'<>%1','ALLE');
      //vkcode.SETFILTER(vkcode.Code,'<>%1','MULTI');
      IF vkcode.FINDFIRST THEN BEGIN
        REPEAT
          v_summe:=0;
          var_bal[1]:=0;
          var_bal[2]:=0;
          var_bal[3]:=0;
          var_bal[4]:=0;
          var_bal[5]:=0;
          var_bal[6]:=0;
          var_bal[7]:=0;
          var_bal[8]:=0;
          var_bal[9]:=0;
          var_bal[10]:=0;
          var_bal[11]:=0;
          var_bal[12]:=0;


      //  bestehende Rahmen
          FOR i := 1 TO 12 DO BEGIN
            vkk.RESET;
            vkk.SETFILTER(vkk."Document Type",'%1',vkk."Document Type"::"Blanket Order");
            vkk.SETFILTER(vkk."Salesperson Code",'%1',vkcode.Code);
            vkk.SETFILTER(vkk."Order Date",'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            IF vkk.FINDFIRST THEN BEGIN
              REPEAT
                vkz.RESET;
                vkz.SETFILTER(vkz."Document No.",'%1',vkk."No.");
                vkz.SETFILTER(vkz.Quantity,'>%1',0);
                IF vkz.FINDFIRST THEN BEGIN
                  REPEAT
                    var_bal[i] := var_bal[i] + (vkz."VK-Preis (MW)"*vkz.Quantity);
                    v_summe:=v_summe + (vkz."VK-Preis (MW)"*vkz.Quantity);
                    v_summe_aur:=v_summe_aur + (vkz."VK-Preis (MW)"*vkz.Quantity);
                    v_summe_total:= v_summe_total + (vkz."VK-Preis (MW)"*vkz.Quantity);
                  UNTIL vkz.NEXT=0;
                END ELSE BEGIN
                  var_bal[i] := 0;
                END;
              UNTIL vkk.NEXT = 0;
            END;
          END;
      //  archivierte Rahmen
          FOR i := 1 TO 12 DO BEGIN
            vkk_arch.RESET;
            vkk_arch.SETFILTER(vkk_arch."Document Type",'%1',vkk_arch."Document Type"::"Blanket Order");
            vkk_arch.SETFILTER(vkk_arch."Salesperson Code",'%1',vkcode.Code);
            vkk_arch.SETFILTER(vkk_arch."Order Date",'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            vkk_arch.SETFILTER(vkk_arch."Version No.",'%1', 1);
            IF vkk_arch.FINDFIRST THEN BEGIN
              REPEAT
                vkz_arch.RESET;
                vkz_arch.SETFILTER(vkz_arch."Document No.",'%1',vkk_arch."No.");
                vkz_arch.SETFILTER(vkz_arch.Quantity,'>%1',0);
                IF vkz_arch.FINDFIRST THEN BEGIN
                  REPEAT
                    IF vkz_arch.Quantity=vkz_arch."Outstanding Quantity" THEN BEGIN
                    END ELSE BEGIN
                      var_bal[i] := var_bal[i] + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                      v_summe:=v_summe + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                      v_summe_aur:=v_summe_aur + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                      v_summe_total:= v_summe_total + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                    END;
                  UNTIL vkz_arch.NEXT=0;
                END ELSE BEGIN
                  var_bal[i] := 0;
                END;
              UNTIL vkk_arch.NEXT = 0;
            END;
          END;

      {    FOR i := 1 TO 12 DO BEGIN
            AU_PER.RESET;
            AU_PER.SETFILTER(AU_PER.Verk„ufercode,'%1',vkcode.Code);
            AU_PER.SETFILTER(Periodendatum,'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            AU_PER.SETFILTER(AU_PER.Art,'%1','AUR');
            IF AU_PER.FINDFIRST THEN BEGIN
              REPEAT
                var_bal[i] := var_bal[i] + AU_PER.Wert_MW;
                v_summe:=v_summe + AU_PER.Wert_MW;
                v_summe_aur:=v_summe_aur + AU_PER.Wert_MW;
                v_summe_total:= v_summe_total + AU_PER.Wert_MW;
              UNTIL AU_PER.NEXT = 0;
            END ELSE BEGIN
              var_bal[i] := 0;
            END;
          END;
      }

          FOR i := 1 TO 12 DO BEGIN
            var_balance_total[i] := var_balance_total[i] + var_bal[i];
            var_bal_total[i] := var_bal_total[i] + var_bal[i];
          END;
      //  Anzeigen wenn AE vorliegt
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,1,vkcode.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,vkcode."First name",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(var_bal[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(var_bal[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(var_bal[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(var_bal[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(var_bal[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(var_bal[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(var_bal[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(var_bal[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(var_bal[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(var_bal[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(var_bal[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(var_bal[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);

          END;
          IF v_summe <> 0 THEN BEGIN
            RowNo := RowNo + 1;
          END;
        UNTIL vkcode.NEXT=0;
      END;


      ////  On Post data Item SP
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'AUR Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_aur),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_bal_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_bal_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_bal_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_bal_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_bal_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_bal_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_bal_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_bal_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_bal_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_bal_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_bal_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_bal_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;

      EnterCell(101,1,'AUR Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(101,3,FORMAT(v_summe_aur),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,4,FORMAT(var_bal_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,5,FORMAT(var_bal_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,6,FORMAT(var_bal_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,7,FORMAT(var_bal_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,8,FORMAT(var_bal_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,9,FORMAT(var_bal_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,10,FORMAT(var_bal_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,11,FORMAT(var_bal_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,12,FORMAT(var_bal_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,13,FORMAT(var_bal_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,14,FORMAT(var_bal_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(101,15,FORMAT(var_bal_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      /////// SP AUBEST on pre  3. TEIL  *****************************************************************************************
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Auftr„ge aus Rahmen','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      // Sheet.Range('A'+j).Value := 'Auftr„ge aus Rahmen';
      RowNo := RowNo + 1;

      ////// SP Aubest on after get record
      vkcode.RESET;
      vkcode.SETFILTER(vkcode.Code,'<>%1','MULTI');
      IF vkcode.FINDFIRST THEN BEGIN
        REPEAT
          v_sum_au:=0;
          v_aubest[1]:=0;
          v_aubest[2]:=0;
          v_aubest[3]:=0;
          v_aubest[4]:=0;
          v_aubest[5]:=0;
          v_aubest[6]:=0;
          v_aubest[7]:=0;
          v_aubest[8]:=0;
          v_aubest[9]:=0;
          v_aubest[10]:=0;
          v_aubest[11]:=0;
          v_aubest[12]:=0;



      {    FOR i := 1 TO 12 DO BEGIN
            AU_PER.RESET;
            AU_PER.SETFILTER(AU_PER.Verk„ufercode,'%1',vkcode.Code);
            AU_PER.SETFILTER(Periodendatum,'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            AU_PER.SETFILTER(AU_PER.Art,'%1','AU');
            AU_PER.SETFILTER(AU_PER."AU aus Rahmen",'%1',TRUE);
            IF AU_PER.FINDFIRST THEN BEGIN
              REPEAT
                v_aubest[i] := v_aubest[i] + AU_PER.Wert_MW;
                v_sum_au:= v_sum_au + AU_PER.Wert_MW;
                v_sum_aubest:= v_sum_aubest + AU_PER.Wert_MW;
                v_summe_total:= v_summe_total - AU_PER.Wert_MW;
              UNTIL AU_PER.NEXT = 0;
            END ELSE BEGIN
              v_aubest[i] := 0;
            END;
          END;
      }

          FOR i := 1 TO 12 DO BEGIN
            AEMTL.RESET;
            AEMTL.SETFILTER(AEMTL.Vertreter,'%1',vkcode.Code);
            AEMTL.SETFILTER(AEMTL.Datum,'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            AEMTL.SETFILTER(AEMTL.Status,'%1','AE');
            AEMTL.SETFILTER(AEMTL."AU aus Rahmen",'%1',TRUE);
            IF AEMTL.FINDFIRST THEN BEGIN
              REPEAT
                v_aubest[i] := v_aubest[i] + AEMTL."Betrag in EUR";
                v_sum_au:= v_sum_au + AEMTL."Betrag in EUR";
                v_sum_aubest:= v_sum_aubest + AEMTL."Betrag in EUR";
                v_summe_total:= v_summe_total + AEMTL."Betrag in EUR";
              UNTIL AEMTL.NEXT = 0;
            END ELSE BEGIN
              v_aubest[i] := 0;
            END;
          END;


          FOR i := 1 TO 12 DO BEGIN
            var_balance_total[i] := var_balance_total[i] - v_aubest[i];
            v_aubest_total[i] := v_aubest_total[i] + v_aubest[i];
          END;
      //  Anzeigen wenn AE vorliegt
          IF v_sum_au <> 0 THEN BEGIN
            EnterCell(RowNo,1,vkcode.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,vkcode."First name",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_sum_au),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(v_aubest[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(v_aubest[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(v_aubest[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(v_aubest[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(v_aubest[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(v_aubest[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(v_aubest[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(v_aubest[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(v_aubest[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(v_aubest[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(v_aubest[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(v_aubest[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
          END;
          IF v_sum_au <> 0 THEN BEGIN
            RowNo := RowNo + 1;
          END;
        UNTIL vkcode.NEXT=0;
      END;


      //// Sp AUBest on Post
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'AU aus Rahmen Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_sum_aubest),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(v_aubest_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(v_aubest_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(v_aubest_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(v_aubest_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(v_aubest_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(v_aubest_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(v_aubest_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(v_aubest_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(v_aubest_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(v_aubest_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(v_aubest_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(v_aubest_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;

      EnterCell(102,1,'AU aus Rahmen Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(102,3,FORMAT(v_sum_aubest),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,4,FORMAT(v_aubest_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,5,FORMAT(v_aubest_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,6,FORMAT(v_aubest_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,7,FORMAT(v_aubest_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,8,FORMAT(v_aubest_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,9,FORMAT(v_aubest_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,10,FORMAT(v_aubest_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,11,FORMAT(v_aubest_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,12,FORMAT(v_aubest_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,13,FORMAT(v_aubest_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,14,FORMAT(v_aubest_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(102,15,FORMAT(v_aubest_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      ///// AUAUR   4. TEIL
      ////  on pre
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Netto RAE','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //  Sheet.Range('A'+j).Value := 'Netto RAE';
      RowNo := RowNo + 1;





      vkcode.RESET;
      vkcode.SETFILTER(vkcode.Code,'<>%1','ALLE');
      //vkcode.SETFILTER(vkcode.Code,'<>%1','MULTI');
      IF vkcode.FINDFIRST THEN BEGIN
        REPEAT
         v_summe:=0;
         v_aubest[1]:=0;
         v_aubest[2]:=0;
         v_aubest[3]:=0;
         v_aubest[4]:=0;
         v_aubest[5]:=0;
         v_aubest[6]:=0;
         v_aubest[7]:=0;
         v_aubest[8]:=0;
         v_aubest[9]:=0;
         v_aubest[10]:=0;
         v_aubest[11]:=0;
         v_aubest[12]:=0;
         v_aubest1[1]:=0;
         v_aubest1[2]:=0;
         v_aubest1[3]:=0;
         v_aubest1[4]:=0;
         v_aubest1[5]:=0;
         v_aubest1[6]:=0;
         v_aubest1[7]:=0;
         v_aubest1[8]:=0;
         v_aubest1[9]:=0;
         v_aubest1[10]:=0;
         v_aubest1[11]:=0;
         v_aubest1[12]:=0;


      //  bestehende Rahmen
          FOR i := 1 TO 12 DO BEGIN
            vkk.RESET;
            vkk.SETFILTER(vkk."Document Type",'%1',vkk."Document Type"::"Blanket Order");
            vkk.SETFILTER(vkk."Salesperson Code",'%1',vkcode.Code);
            vkk.SETFILTER(vkk."Order Date",'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            IF vkk.FINDFIRST THEN BEGIN
              REPEAT
                vkz.RESET;
                vkz.SETFILTER(vkz."Document No.",'%1',vkk."No.");
                vkz.SETFILTER(vkz.Quantity,'>%1',0);
                IF vkz.FINDFIRST THEN BEGIN
                  REPEAT
                     v_aubest1[i]:=v_aubest1[i] +  (vkz."VK-Preis (MW)"*vkz.Quantity);
                    v_summe:=v_summe + (vkz."VK-Preis (MW)"*vkz.Quantity);
                    v_summe_aur:=v_summe_aur + (vkz."VK-Preis (MW)"*vkz.Quantity);
                    v_summe_total:= v_summe_total + (vkz."VK-Preis (MW)"*vkz.Quantity);
                  UNTIL vkz.NEXT=0;
                END ELSE BEGIN
                  var_bal[i] := 0;
                END;
              UNTIL vkk.NEXT = 0;
            END;
          END;
      //  archivierte Rahmen
          FOR i := 1 TO 12 DO BEGIN
            vkk_arch.RESET;
            vkk_arch.SETFILTER(vkk_arch."Document Type",'%1',vkk_arch."Document Type"::"Blanket Order");
            vkk_arch.SETFILTER(vkk_arch."Salesperson Code",'%1',vkcode.Code);
            vkk_arch.SETFILTER(vkk_arch."Order Date",'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            vkk_arch.SETFILTER(vkk_arch."Version No.",'%1', 1);
            IF vkk_arch.FINDFIRST THEN BEGIN
              REPEAT
                vkz_arch.RESET;
                vkz_arch.SETFILTER(vkz_arch."Document No.",'%1',vkk_arch."No.");
                vkz_arch.SETFILTER(vkz_arch.Quantity,'>%1',0);
                IF vkz_arch.FINDFIRST THEN BEGIN
                  REPEAT
                    IF vkz_arch.Quantity=vkz_arch."Outstanding Quantity" THEN BEGIN
                    END ELSE BEGIN
                    v_aubest1[i]:=v_aubest1[i] + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
      //                var_bal[i] := var_bal[i] + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                      v_summe:=v_summe + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                      v_summe_aur:=v_summe_aur + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                      v_summe_total:= v_summe_total + (vkz_arch."VK-Preis (MW)"*(vkz_arch.Quantity-vkz_arch."Outstanding Quantity"));
                    END;
                  UNTIL vkz_arch.NEXT=0;
                END ELSE BEGIN
                  v_aubest1[i] := 0;
                END;
              UNTIL vkk_arch.NEXT = 0;
            END;
          END;
      //    Auftr„ge aus Rahmen
          FOR i := 1 TO 12 DO BEGIN
            AEMTL.RESET;
            AEMTL.SETFILTER(AEMTL.Vertreter,'%1',vkcode.Code);
            AEMTL.SETFILTER(AEMTL.Datum,'%1..%2',PeriodStartDate[i],PeriodStartDate[i+1] - 1);
            AEMTL.SETFILTER(AEMTL.Status,'%1','AE');
            AEMTL.SETFILTER(AEMTL."AU aus Rahmen",'%1',TRUE);
            IF AEMTL.FINDFIRST THEN BEGIN
              REPEAT
                v_aubest[i] := v_aubest[i] + AEMTL."Betrag in EUR";
                v_sum_au:= v_sum_au + AEMTL."Betrag in EUR";
                v_sum_aubest:= v_sum_aubest + AEMTL."Betrag in EUR";
                v_summe:= v_summe - AEMTL."Betrag in EUR";
                v_summe_total:= v_summe_total - AEMTL."Betrag in EUR";
              UNTIL AEMTL.NEXT = 0;
            END ELSE BEGIN
              v_aubest[i] := 0;
            END;
          END;

       FOR i := 1 TO 12 DO BEGIN
            var_balance_total[i] := var_balance_total[i] +  v_aubest1[i]-v_aubest[i];
            var_bal_total[i] := var_bal_total[i] + v_aubest1[i];
      //      v_aubest1_total[i]:= v_aubest1_total[i] + v_aubest1[i];
            v_summe_aur1:= v_summe_aur1 + v_aubest1[i]- v_aubest[i];
            v_aubest1_total[i] := v_aubest1_total[i] + v_aubest1[i]- v_aubest[i];
          END;
      //  Anzeigen wenn AE vorliegt
          IF v_summe <> 0 THEN BEGIN
            EnterCell(RowNo,1,vkcode.Code,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,2,vkcode."First name",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
            EnterCell(RowNo,3,FORMAT(v_summe),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,4,FORMAT(v_aubest1[1]- v_aubest[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,5,FORMAT(v_aubest1[2]- v_aubest[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,6,FORMAT(v_aubest1[3]- v_aubest[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,7,FORMAT(v_aubest1[4]- v_aubest[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,8,FORMAT(v_aubest1[5]- v_aubest[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,9,FORMAT(v_aubest1[6]- v_aubest[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,10,FORMAT(v_aubest1[7]- v_aubest[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,11,FORMAT(v_aubest1[8]- v_aubest[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,12,FORMAT(v_aubest1[9]- v_aubest[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,13,FORMAT(v_aubest1[10]- v_aubest[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,14,FORMAT(v_aubest1[11]- v_aubest[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
            EnterCell(RowNo,15,FORMAT(v_aubest1[12]- v_aubest[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);

          END;
          IF v_summe <> 0 THEN BEGIN
            RowNo := RowNo + 1;
          END;
        UNTIL vkcode.NEXT=0;
      END;


      /////AUAUR - OnPostDataItem()
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Netto RAE Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_summe_aur1),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(v_aubest1_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(v_aubest1_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(v_aubest1_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(v_aubest1_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(v_aubest1_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(v_aubest1_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(v_aubest1_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(v_aubest1_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(v_aubest1_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(v_aubest1_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(v_aubest1_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(v_aubest1_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;

      //Post Report
      RowNo := RowNo + 1;
      EnterCell(RowNo,1,'Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,4,FORMAT(var_balance_total[1]-v_aubest1_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,5,FORMAT(var_balance_total[2]-v_aubest1_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,6,FORMAT(var_balance_total[3]-v_aubest1_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,7,FORMAT(var_balance_total[4]-v_aubest1_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,8,FORMAT(var_balance_total[5]-v_aubest1_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,9,FORMAT(var_balance_total[6]-v_aubest1_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,10,FORMAT(var_balance_total[7]-v_aubest1_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,11,FORMAT(var_balance_total[8]-v_aubest1_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,12,FORMAT(var_balance_total[9]-v_aubest1_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,13,FORMAT(var_balance_total[10]-v_aubest1_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,14,FORMAT(var_balance_total[11]-v_aubest1_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(RowNo,15,FORMAT(var_balance_total[12]-v_aubest1_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;
      RowNo := RowNo + 1;


      vkz.RESET;


      vkz.SETFILTER(vkz."Document Type",'%1',vkz."Document Type"::Order);
      vkz.SETFILTER(vkz.Type,'%1',vkz.Type::Item);
      vkz.SETFILTER(vkz."Location Code",'%1|%2|%3|%4','ZENT','KONSI','ERSATZ','IDT');
      vkz.SETFILTER(vkz."Outstanding Quantity",'>%1',0);
      IF vkz.FINDFIRST THEN BEGIN
        REPEAT
          v_au_wert := v_au_wert + (vkz."Outstanding Quantity" * vkz."VK-Preis (MW)");
        UNTIL vkz.NEXT = 0;
      END;

      vkz.RESET;
      vkz.SETFILTER(vkz."Document Type",'%1',vkz."Document Type"::Order);
      vkz.SETFILTER(vkz.Type,'%1',vkz.Type::Item);
      vkz.SETFILTER(vkz."Location Code",'%1|%2|%3|%4','ZENT','KONSI','ERSATZ','IDT');
      vkz.SETFILTER(vkz."Outstanding Quantity",'>%1',0);
      vkz.SETFILTER(vkz."Blanket Order No.",'<>%1','');
      IF vkz.FINDFIRST THEN BEGIN
        REPEAT
          v_sum_au_rahmen := v_sum_au_rahmen + (vkz."Outstanding Quantity" * vkz."VK-Preis (MW)");
        UNTIL vkz.NEXT = 0;
      END;

      vkz.RESET;
      vkz.CALCFIELDS("offene Menge aus Rahmen im AU");
      vkz.SETFILTER(vkz."Document Type",'%1',vkz."Document Type"::"Blanket Order");
      vkz.SETFILTER(vkz.Type,'%1',vkz.Type::Item);
      vkz.SETFILTER(vkz."Location Code",'%1|%2|%3|%4','ZENT','KONSI','ERSATZ','IDT');
      vkz.SETFILTER(vkz."Outstanding Quantity",'>%1',0);
      IF vkz.FINDFIRST THEN BEGIN
        REPEAT
      //      v_au_menge:=0;
      //           vkz1.RESET;
      //           vkz1.SETFILTER(vkz1."Blanket Order No.",'%1',vkz."Document No.");
      //           vkz1.SETFILTER(vkz1."Blanket Order Line No.",'%1',vkz."Line No.");
      //           vkz1.SETFILTER(vkz1."Outstanding Quantity",'<>%1',0);
      //               IF vkz1.FINDFIRST THEN BEGIN
      //               REPEAT
      //                 v_au_menge:=0;
      //                 v_au_menge:=v_au_menge+(vkz1."Outstanding Quantity");
      //               UNTIL vkz1.NEXT = 0;
      //               END;
      //            var_vkk.RESET;
      //            var_vkk.SETFILTER(var_vkk."No.",'%1',vkz."Document No.");
      //            IF var_vkk.FINDFIRST THEN BEGIN
      //              IF var_vkk."Currency Code"='' THEN BEGIN
      //                 v_aur_wert:=(v_aur_wert+ ROUND((vkz."Outstanding Quantity")-(vkz."offene Menge aus Rahmen im AU"))
      //                  *vkz."Line Amount"/vkz.Quantity);
      //                END ELSE BEGIN
      //                 v_aur_wert:=(v_aur_wert+ ROUND((vkz."Outstanding Quantity")-(vkz."offene Menge aus Rahmen im AU"))
      //                 *vkz."Line Amount"/vkz.Quantity/var_vkk."Currency Factor");
      //                END;
      //             END;

      //  v_aur_wert:= v_aur_wert+(vkz."Outstanding Quantity"* vkz."VK-Preis (MW)");
      vkz.CALCFIELDS("offene Menge aus Rahmen im AU");
         v_aur_wert:= v_aur_wert+ (vkz.Quantity-vkz."Quantity Shipped"-vkz."offene Menge aus Rahmen im AU")*vkz."VK-Preis (MW)";
        UNTIL vkz.NEXT = 0;
      END;

      EnterCell(RowNo,1,'Gesamt Auftragsbestand:','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //Sheet.Range('A'+j).Value := 'Gesamt Auftragsbestand:';
      EnterCell(RowNo,3,FORMAT(v_au_wert),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //Sheet.Range('C'+j).Value := v_au_wert;

      RowNo := RowNo + 1;
      RowNo := RowNo + 1;
      //Sheet.Range('A'+j).Value := 'Gesamt Rahmenbestand:';
      EnterCell(RowNo,1,'Gesamt Rahmenbestand:','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,3,FORMAT(v_aur_wert),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //Sheet.Range('C'+j).Value := v_aur_wert;
      //EnterCell(RowNo,3,FORMAT(v_aur_wert-v_sum_au_rahmen),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //Sheet.Range('C'+j).Value := v_aur_wert-v_sum_au_rahmen;

      EnterCell(104,1,'Gesamt Monat','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(104,3,FORMAT(v_summe_total),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,4,FORMAT(var_balance_total[1]-v_aubest1_total[1]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,5,FORMAT(var_balance_total[2]-v_aubest1_total[2]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,6,FORMAT(var_balance_total[3]-v_aubest1_total[3]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,7,FORMAT(var_balance_total[4]-v_aubest1_total[4]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,8,FORMAT(var_balance_total[5]-v_aubest1_total[5]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,9,FORMAT(var_balance_total[6]-v_aubest1_total[6]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,10,FORMAT(var_balance_total[7]-v_aubest1_total[7]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,11,FORMAT(var_balance_total[8]-v_aubest1_total[8]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,12,FORMAT(var_balance_total[9]-v_aubest1_total[9]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,13,FORMAT(var_balance_total[10]-v_aubest1_total[10]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,14,FORMAT(var_balance_total[11]-v_aubest1_total[11]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(104,15,FORMAT(var_balance_total[12]-v_aubest1_total[12]),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //Sheet.Range('A106').Value := 'Gesamt Auftragsbestand:';
      //Sheet.Range('C106').Value := v_au_wert;
      EnterCell(106,1,'Gesamt Auftragsbestand:','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(106,3,FORMAT(v_au_wert),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //Sheet.Range('A107').Value := 'Gesamt Rahmenbestand:';
      //Sheet.Range('C107').Value := v_aur_wert;
      //Sheet.Range('C107').Value := v_aur_wert-v_sum_au_rahmen;
      EnterCell(107,1,'Gesamt Rahmenbestand:','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(107,3,FORMAT(v_aur_wert),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      EnterCell(107,4,FORMAT(v_aur_wert-v_sum_au_rahmen),'',FALSE,FALSE,FALSE,'##,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      CloseExcel('Daten_Nav_AE','Daten_Nav_AE','F:\Tausch\Nav\Daten');
    END;

    LOCAL PROCEDURE Daten_Nav_Champs_gesamt@1000000012();
    BEGIN
      IF Abgrenz_Datum = 0D THEN ERROR('Es wurde kein Datum eingegeben. Report abgebrochen!');
      //Variablenbelegung
      liefnr:='LS00';
      liefzeilennr:=10;
      CreateExcel;
      //RowNo := 3;
      //EnterCell(RowNo,1,'Abgrenzung der stichtagsbergreifenden Champsvereinbarungen zum  ','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,7,FORMAT(Abgrenz_Datum),'',TRUE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //RowNo := 4;
      //EnterCell(RowNo,1,'Lfd.Nr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,2,'Ablauf-Datum','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,3,'Art','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,4,'Nr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,5,'ZeilenNr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,6,'Belegdatum','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,7,'Artikelnr','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,8,'Seriennr','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,9,'Debitorennr','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,10,'Debitorname','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,11,'ChampsNr','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,12,'WartVertragNr','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,13,'Menge','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,14,'Einstandspreis','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,15,'VK','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,16,'Lizenzdatum','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,17,'Ablaufdatum','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,18,'LZ in Tagen','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,19,'Abgr in Tagen','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,20,'Abgr EK','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,21,'Abgr VK','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,23,'WartVertragNr2','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,24,'BET-Nr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //EnterCell(RowNo,25,'ACO-Nr.','',TRUE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      service.RESET;
      service.SETCURRENTKEY("Wartungsvertragsnr.","Nr.","Belegzeilennr.");
      service.SETFILTER(service.Art,'%1',service.Art::Service);
      service.SETFILTER(service."Ablaufdatum Serviceleistung",'>%1',Abgrenz_Datum);
      service.SETFILTER(service.Belegdatum,'<=%1',Abgrenz_Datum);
      service.SETFILTER(service.Inaktiv,'%1',FALSE);
      //Eingrezungen auf bestimmte Artikel
      service.SETFILTER(service."SUP Artikelnr.",'<>%1&<>%2','RE_INSTATEMENT_FEE','CHAMPS-RE_INSTATE#01');
      IF service.FINDFIRST THEN BEGIN
        REPEAT
          Artikel.RESET;
          Artikel.SETFILTER(Artikel."No.",'%1',service."SUP Artikelnr.");
          Artikel.SETFILTER(Artikel."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
          //   artikel.SETFILTER(artikel.Artikelgruppe,'<>%1','CHAMPS_FEE');
          IF Artikel.FINDFIRST THEN BEGIN
            LZ_rest:=0;
            lief.RESET;
            lief.SETFILTER(lief."Document No.",'%1',service."Nr.");
            lief.SETFILTER(lief."Line No.",'%1',service."Belegzeilennr.");
            lief.SETFILTER(lief."Manufacturer Code",'<>%1&<>%2&<>%3','5710','5720','5730');
            IF lief.FINDFIRST THEN BEGIN
      //        RowNo := RowNo + 1;
      //        EnterCell(RowNo,1,Service."Lfd. Nr.",'',FALSE,FALSE,FALSE,'######',TempExcelBuffer."Cell Type"::Number);
      //        EnterCell(RowNo,2,FORMAT(Service."Ablaufdatum Serviceleistung"),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //        EnterCell(RowNo,3,FORMAT(Service.Art),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,4,Service."Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,5,FORMAT(Service."Belegzeilennr."),'',FALSE,FALSE,FALSE,'######',TempExcelBuffer."Cell Type"::Number);
      //        EnterCell(RowNo,6,FORMAT(Service.Belegdatum),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //        EnterCell(RowNo,7,Service."Artikelnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,8,Service."Seriennr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,9,Service."Debitornr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,10,Service.Debitorname,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,11,Service."SUP Artikelnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //        EnterCell(RowNo,12,Service."Hauptwartungsvertragsnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
              IF (liefnr=lief."Document No.") AND (liefzeilennr=lief."Line No.") THEN BEGIN
              END ELSE BEGIN
      //          EnterCell(RowNo,13,FORMAT(Lief.Quantity),'',FALSE,FALSE,FALSE,'#,###,###',TempExcelBuffer."Cell Type"::Number);
      //          EnterCell(RowNo,14,FORMAT(Lief."Unit Cost (LCY)"),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //          EnterCell(RowNo,15,FORMAT(Lief."Unit Price"),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
                LZ_tage:= (service."Ablaufdatum Serviceleistung"- service.Lizenzdatum-1);
                LZ_tage_stich:=(service."Ablaufdatum Serviceleistung"-Abgrenz_Datum-1);
                LZ_tage_bewert:=0;
      //          EnterCell(RowNo,16,FORMAT(Service.Lizenzdatum),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //          EnterCell(RowNo,17,FORMAT(Service."Ablaufdatum Serviceleistung"),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //          EnterCell(RowNo,18,FORMAT(LZ_tage),'',FALSE,FALSE,FALSE,'######',TempExcelBuffer."Cell Type"::Number);
                IF LZ_tage_stich>LZ_tage THEN BEGIN
                  LZ_tage_bewert := LZ_tage;
                END ELSE BEGIN
                  LZ_tage_bewert := LZ_tage_stich;
                END;
      //          EnterCell(RowNo,19,FORMAT(LZ_tage_bewert),'',FALSE,FALSE,FALSE,'######',TempExcelBuffer."Cell Type"::Number);
      //          EnterCell(RowNo,20,FORMAT(ROUND((Lief."Unit Cost (LCY)"/ LZ_tage*LZ_tage_bewert*Lief.Quantity),0.01)),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //          EnterCell(RowNo,21,FORMAT(ROUND((Lief."VK-Preis (MW)"/ LZ_tage*LZ_tage_bewert*Lief.Quantity),0.01)),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
                Sum_ek:=(Sum_ek+ (ROUND(lief."Unit Cost (LCY)"/ LZ_tage*LZ_tage_bewert*lief.Quantity)));
                Sum_vk:=(Sum_vk+ (ROUND(lief."VK-Preis (MW)"/ LZ_tage*LZ_tage_bewert*lief.Quantity)));
                liefnr:=lief."Document No.";
                liefzeilennr:=lief."Line No.";
      //          EnterCell(RowNo,23,Service."Wartungsvertragsnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,24,Service."BET-Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,25,Service."ACO Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
              END;
            END ELSE BEGIN
      //    Anfang Lieferscheine aus Beleghistorie
              LZ_rest:=0;
              beleghis_ek:=0;
              beleghis.RESET;
              beleghis.SETFILTER(beleghis."Belegnr.",'%1',service."Nr.");
              beleghis.SETFILTER(beleghis."Zeilennr.",'%1',service."Belegzeilennr.");
              beleghis.SETFILTER(beleghis.Herstellercode,'<>%1&<>%2&<>%3','5710','5720','5730');
              IF beleghis.FINDFIRST THEN BEGIN
      //          RowNo := RowNo + 1;
      //          EnterCell(RowNo,1,Service."Lfd. Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,2,FORMAT(Service."Ablaufdatum Serviceleistung"),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //          EnterCell(RowNo,3,FORMAT(Service.Art),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,4,Service."Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,5,FORMAT(Service."Belegzeilennr."),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Number);
      //          EnterCell(RowNo,6,FORMAT(Service.Belegdatum),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //          EnterCell(RowNo,7,Service."Artikelnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,8,Service."Seriennr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,9,Service."Debitornr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,10,Service.Debitorname,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,11,Service."SUP Artikelnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //          EnterCell(RowNo,12,Service."Hauptwartungsvertragsnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
                IF (liefnr=beleghis."Belegnr.") AND (liefzeilennr=beleghis."Zeilennr.") THEN BEGIN
                END ELSE BEGIN
      //            EnterCell(RowNo,13,FORMAT(beleghis.Menge),'',FALSE,FALSE,FALSE,'#,###,###',TempExcelBuffer."Cell Type"::Number);
                  beleghis_ek:= ROUND((beleghis."Einstandspreis MW"/((100+Artikel."Handlingskosten %"+Artikel."Zollsatz %")/100)),0.01);
      //            EnterCell(RowNo,14,FORMAT(beleghis_ek),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //            EnterCell(RowNo,15,FORMAT(beleghis."VK-Preis"),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
                  LZ_tage:= (service."Ablaufdatum Serviceleistung"- service.Lizenzdatum-1);
                  LZ_tage_stich:=(service."Ablaufdatum Serviceleistung"-Abgrenz_Datum-1);
                  LZ_tage_bewert:=0;
      //            EnterCell(RowNo,16,FORMAT(Service.Lizenzdatum),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //            EnterCell(RowNo,17,FORMAT(Service."Ablaufdatum Serviceleistung"),'',FALSE,FALSE,FALSE,'dd.mm.yyyy',TempExcelBuffer."Cell Type"::Date);
      //            EnterCell(RowNo,18,FORMAT(LZ_tage),'',FALSE,FALSE,FALSE,'######',TempExcelBuffer."Cell Type"::Number);
                  IF LZ_tage_stich>LZ_tage THEN BEGIN
                    LZ_tage_bewert := LZ_tage;
                  END ELSE BEGIN
                    LZ_tage_bewert := LZ_tage_stich;
                  END;
      //            EnterCell(RowNo,19,FORMAT(LZ_tage_bewert),'',FALSE,FALSE,FALSE,'######',TempExcelBuffer."Cell Type"::Number);
      //            EnterCell(RowNo,20,FORMAT(ROUND((beleghis_ek / LZ_tage * LZ_tage_bewert * beleghis.Menge),0.01)),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
      //            EnterCell(RowNo,21,FORMAT(ROUND((beleghis."VK-Preis" / LZ_tage*LZ_tage_bewert*beleghis.Menge),0.01)),'',FALSE,FALSE,FALSE,'###,##0.00',TempExcelBuffer."Cell Type"::Number);
                  Sum_ek:=(Sum_ek+ (ROUND(beleghis_ek / LZ_tage * LZ_tage_bewert * beleghis.Menge)));
                  Sum_vk:=(Sum_vk+ (ROUND(beleghis."VK-Preis"/ LZ_tage*LZ_tage_bewert*beleghis.Menge)));
                  liefnr:=beleghis."Belegnr.";
                  liefzeilennr:=beleghis."Zeilennr.";
      //            EnterCell(RowNo,23,Service."Wartungsvertragsnr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //            EnterCell(RowNo,24,Service."BET-Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      //            EnterCell(RowNo,25,Service."ACO Nr.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
                END;
              END;
      //      Ende Lieferscheine holen aus Beleghistorie
            END;
          END;
        UNTIL service.NEXT=0;
      END;
      RowNo := 22;
      EnterCell(RowNo,1,'Abgrenz_Ek','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(Sum_ek),'',FALSE,FALSE,FALSE,'###,###,##0.00',TempExcelBuffer."Cell Type"::Number);
      RowNo := 23;
      EnterCell(RowNo,1,'Abgrenz_Vk','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      EnterCell(RowNo,2,FORMAT(Sum_vk),'',FALSE,FALSE,FALSE,'###,###,##0.00',TempExcelBuffer."Cell Type"::Number);

      CloseExcel('Daten_Nav_Champs','Daten_Nav_Champs','F:\Tausch\Nav\Daten');
      //MESSAGE(Text003);
    END;

    LOCAL PROCEDURE Daten_NAV_Bestellbestand@1000000013();
    VAR
      CurrExchRate@1000000002 : Record 330;
      EinkBestBetrag@1000000000 : Decimal;
      EinkBestBetragMW@1000000001 : Decimal;
      TotalAmount@1000000003 : Decimal;
      TotalAmountMW@1000000004 : Decimal;
      ExchRate_USD@1000000005 : Decimal;
    BEGIN
      CreateExcel;
      RowNo := 2;
      //šberschriften
      ColumnNo := 1;
      EnterCell(RowNo,ColumnNo,'Document No.','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Vendor No.','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Vendor','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Order Date','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Expected Shipment Date','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Requested Receipt Date','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Promised Receipt Date','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Item No.','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'P.O.','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Quantity','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Outstanding Quantity','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Direct Unit Cost','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Amount','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Amount EURO','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Currency Code','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Customer','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Avis','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'Comments','',TRUE,FALSE,TRUE,'',TempExcelBuffer."Cell Type"::Text);
      RowNo := 3;

      PurchaseLine.RESET;
      PurchaseLine.SETFILTER("Outstanding Quantity",'>%1',0);
      PurchaseLine.SETFILTER("Manufacturer Code",'57|5710|5720');
      IF PurchaseLine.FINDFIRST THEN BEGIN
        REPEAT
          PurchaseHeader.GET(PurchaseHeader."Document Type"::Order,PurchaseLine."Document No.");
          ColumnNo := 1;
          EnterCell(RowNo,ColumnNo,PurchaseHeader."No.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseHeader."Buy-from Vendor No.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Number);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseHeader."Buy-from Vendor Name",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseHeader."Order Date"),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Date);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine."Expected Receipt Date"),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Date);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine."Requested Receipt Date"),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Date);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine."Promised Receipt Date"),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Date);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseLine."No.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseHeader."Vendor Order No.",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine.Quantity),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Number);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine."Outstanding Quantity"),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Number);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine."Direct Unit Cost"),'',FALSE,FALSE,FALSE,'#,##0.00',TempExcelBuffer."Cell Type"::Number);
          EinkBestBetrag := ROUND(PurchaseLine."Outstanding Quantity" * PurchaseLine."Line Amount" / PurchaseLine.Quantity);
          EinkBestBetragMW := EinkBestBetrag;
          IF PurchaseHeader."Currency Code" <> '' THEN BEGIN
            IF PurchaseHeader."Currency Factor" <> 0 THEN
              EinkBestBetragMW := ROUND(CurrExchRate.ExchangeAmtFCYToLCY(WORKDATE,PurchaseHeader."Currency Code",EinkBestBetragMW,PurchaseHeader."Currency Factor"));
          END;
          TotalAmount += EinkBestBetrag;
          TotalAmountMW += EinkBestBetragMW;
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(EinkBestBetrag),'',FALSE,FALSE,FALSE,'#,##0.00',TempExcelBuffer."Cell Type"::Number);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(EinkBestBetragMW),'',FALSE,FALSE,FALSE,'#,##0.00',TempExcelBuffer."Cell Type"::Number);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseLine."Currency Code",'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseLine.Description,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,FORMAT(PurchaseLine.Avis),'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          ColumnNo := ColumnNo + 1;
          EnterCell(RowNo,ColumnNo,PurchaseLine.Bemerkung,'',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
          RowNo := RowNo + 1;
        UNTIL PurchaseLine.NEXT = 0;
      END;

      RowNo := 1;
      ColumnNo := 1;
      EnterCell(RowNo,ColumnNo,FORMAT(TotalAmount),'',FALSE,FALSE,FALSE,'#,##0.00',TempExcelBuffer."Cell Type"::Number);
      CurrExchRate.SETRANGE("Currency Code",'USD');
      IF CurrExchRate.FINDLAST THEN
        ExchRate_USD := CurrExchRate."Exchange Rate Amount";
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,FORMAT(ExchRate_USD),'',FALSE,FALSE,FALSE,'#,##0.0000',TempExcelBuffer."Cell Type"::Number);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,FORMAT(ROUND(TotalAmount/ExchRate_USD)),'',FALSE,FALSE,FALSE,'#,##0.00',TempExcelBuffer."Cell Type"::Number);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,FORMAT(TotalAmountMW),'',FALSE,FALSE,FALSE,'#,##0.00',TempExcelBuffer."Cell Type"::Number);

      ColumnNo := 15;
      EnterCell(RowNo,ColumnNo,'A1=Saldo EKW','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'B1=Akt. Tageskurs USD/EURO','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'C1=Saldo MW/Tageskurs ','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      ColumnNo := ColumnNo + 1;
      EnterCell(RowNo,ColumnNo,'D1=Saldo MW/exakt ','',FALSE,FALSE,FALSE,'',TempExcelBuffer."Cell Type"::Text);
      CloseExcel('Daten_Nav_Bestellbestand','Daten_Nav_Bestellbestand','F:\Tausch\Nav\Daten');
    END;

    BEGIN
    {

      // Achtung: Beim šberschreiben der Excel-Files kommt noch ein Fenster hoch, ob Datei berschrieben werden soll
      *******************************************************************************************************************



      // Function Champs wird von OnPreReport() gestartet und ruft weitere Function auf, die wieder weitere aufrufen
      // Function Champs         startet Function Vorl_GuV;
      // Function Vorl_GuV       startet Function Rohbilanz;
      // Function Rohbilanz      startet Function Systeme;
      // Function Systeme        startet Function Dienstleistung;
      // Function Dienstleistung startet Function Umsatz;
      // Function Umsatz         startet Function Hersteller;
      // Function Herseller      beendet den Job.

      // Function Rohbilanz_Test und Systeme_Test werden nicht benutzt und rufen keine weiteren Functions auf.
    }
    END.
  }
  RDLDATA
  {
  }
}

